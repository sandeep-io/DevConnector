{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ListCollectionsOperation = void 0;\nconst responses_1 = require(\"../cmap/wire_protocol/responses\");\nconst utils_1 = require(\"../utils\");\nconst command_1 = require(\"./command\");\nconst operation_1 = require(\"./operation\");\n/** @internal */\nclass ListCollectionsOperation extends command_1.CommandOperation {\n  constructor(db, filter, options) {\n    super(db, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.CursorResponse;\n    this.options = {\n      ...options\n    };\n    delete this.options.writeConcern;\n    this.db = db;\n    this.filter = filter;\n    this.nameOnly = !!this.options.nameOnly;\n    this.authorizedCollections = !!this.options.authorizedCollections;\n    if (typeof this.options.batchSize === 'number') {\n      this.batchSize = this.options.batchSize;\n    }\n    this.SERVER_COMMAND_RESPONSE_TYPE = this.explain ? responses_1.ExplainedCursorResponse : responses_1.CursorResponse;\n  }\n  get commandName() {\n    return 'listCollections';\n  }\n  buildCommandDocument(connection) {\n    const command = {\n      listCollections: 1,\n      filter: this.filter,\n      cursor: this.batchSize ? {\n        batchSize: this.batchSize\n      } : {},\n      nameOnly: this.nameOnly,\n      authorizedCollections: this.authorizedCollections\n    };\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if ((0, utils_1.maxWireVersion)(connection) >= 9 && this.options.comment !== undefined) {\n      command.comment = this.options.comment;\n    }\n    return command;\n  }\n  handleOk(response) {\n    return response;\n  }\n}\nexports.ListCollectionsOperation = ListCollectionsOperation;\n(0, operation_1.defineAspects)(ListCollectionsOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE, operation_1.Aspect.CURSOR_CREATING, operation_1.Aspect.SUPPORTS_RAW_DATA]);","map":{"version":3,"names":["responses_1","require","utils_1","command_1","operation_1","ListCollectionsOperation","CommandOperation","constructor","db","filter","options","SERVER_COMMAND_RESPONSE_TYPE","CursorResponse","writeConcern","nameOnly","authorizedCollections","batchSize","explain","ExplainedCursorResponse","commandName","buildCommandDocument","connection","command","listCollections","cursor","maxWireVersion","comment","undefined","handleOk","response","exports","defineAspects","Aspect","READ_OPERATION","RETRYABLE","CURSOR_CREATING","SUPPORTS_RAW_DATA"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\list_collections.ts"],"sourcesContent":["import { type Connection } from '..';\nimport type { Binary, Document } from '../bson';\nimport { CursorResponse, ExplainedCursorResponse } from '../cmap/wire_protocol/responses';\nimport { type CursorTimeoutContext, type CursorTimeoutMode } from '../cursor/abstract_cursor';\nimport type { Db } from '../db';\nimport { type Abortable } from '../mongo_types';\nimport { maxWireVersion } from '../utils';\nimport { CommandOperation, type CommandOperationOptions } from './command';\nimport { Aspect, defineAspects } from './operation';\n\n/** @public */\nexport interface ListCollectionsOptions\n  extends Omit<CommandOperationOptions, 'writeConcern'>,\n    Abortable {\n  /** Since 4.0: If true, will only return the collection name in the response, and will omit additional info */\n  nameOnly?: boolean;\n  /** Since 4.0: If true and nameOnly is true, allows a user without the required privilege (i.e. listCollections action on the database) to run the command when access control is enforced. */\n  authorizedCollections?: boolean;\n  /** The batchSize for the returned command cursor or if pre 2.8 the systems batch collection */\n  batchSize?: number;\n  /** @internal */\n  timeoutMode?: CursorTimeoutMode;\n\n  /** @internal */\n  timeoutContext?: CursorTimeoutContext;\n}\n\n/** @internal */\nexport class ListCollectionsOperation extends CommandOperation<CursorResponse> {\n  override SERVER_COMMAND_RESPONSE_TYPE = CursorResponse;\n  /**\n   * @remarks WriteConcern can still be present on the options because\n   * we inherit options from the client/db/collection.  The\n   * key must be present on the options in order to delete it.\n   * This allows typescript to delete the key but will\n   * not allow a writeConcern to be assigned as a property on options.\n   */\n  override options: ListCollectionsOptions & { writeConcern?: never };\n  db: Db;\n  filter: Document;\n  nameOnly: boolean;\n  authorizedCollections: boolean;\n  batchSize?: number;\n\n  constructor(db: Db, filter: Document, options?: ListCollectionsOptions) {\n    super(db, options);\n\n    this.options = { ...options };\n    delete this.options.writeConcern;\n    this.db = db;\n    this.filter = filter;\n    this.nameOnly = !!this.options.nameOnly;\n    this.authorizedCollections = !!this.options.authorizedCollections;\n\n    if (typeof this.options.batchSize === 'number') {\n      this.batchSize = this.options.batchSize;\n    }\n\n    this.SERVER_COMMAND_RESPONSE_TYPE = this.explain ? ExplainedCursorResponse : CursorResponse;\n  }\n\n  override get commandName() {\n    return 'listCollections' as const;\n  }\n\n  override buildCommandDocument(connection: Connection): Document {\n    const command: Document = {\n      listCollections: 1,\n      filter: this.filter,\n      cursor: this.batchSize ? { batchSize: this.batchSize } : {},\n      nameOnly: this.nameOnly,\n      authorizedCollections: this.authorizedCollections\n    };\n\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if (maxWireVersion(connection) >= 9 && this.options.comment !== undefined) {\n      command.comment = this.options.comment;\n    }\n\n    return command;\n  }\n\n  override handleOk(\n    response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>\n  ): CursorResponse {\n    return response;\n  }\n}\n\n/** @public */\nexport interface CollectionInfo extends Document {\n  name: string;\n  type?: string;\n  options?: Document;\n  info?: {\n    readOnly?: false;\n    uuid?: Binary;\n  };\n  idIndex?: Document;\n}\n\ndefineAspects(ListCollectionsOperation, [\n  Aspect.READ_OPERATION,\n  Aspect.RETRYABLE,\n  Aspect.CURSOR_CREATING,\n  Aspect.SUPPORTS_RAW_DATA\n]);\n"],"mappings":";;;;;;AAEA,MAAAA,WAAA,GAAAC,OAAA;AAIA,MAAAC,OAAA,GAAAD,OAAA;AACA,MAAAE,SAAA,GAAAF,OAAA;AACA,MAAAG,WAAA,GAAAH,OAAA;AAmBA;AACA,MAAaI,wBAAyB,SAAQF,SAAA,CAAAG,gBAAgC;EAgB5EC,YAAYC,EAAM,EAAEC,MAAgB,EAAEC,OAAgC;IACpE,KAAK,CAACF,EAAE,EAAEE,OAAO,CAAC;IAhBX,KAAAC,4BAA4B,GAAGX,WAAA,CAAAY,cAAc;IAkBpD,IAAI,CAACF,OAAO,GAAG;MAAE,GAAGA;IAAO,CAAE;IAC7B,OAAO,IAAI,CAACA,OAAO,CAACG,YAAY;IAChC,IAAI,CAACL,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACC,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACK,QAAQ,GAAG,CAAC,CAAC,IAAI,CAACJ,OAAO,CAACI,QAAQ;IACvC,IAAI,CAACC,qBAAqB,GAAG,CAAC,CAAC,IAAI,CAACL,OAAO,CAACK,qBAAqB;IAEjE,IAAI,OAAO,IAAI,CAACL,OAAO,CAACM,SAAS,KAAK,QAAQ,EAAE;MAC9C,IAAI,CAACA,SAAS,GAAG,IAAI,CAACN,OAAO,CAACM,SAAS;IACzC;IAEA,IAAI,CAACL,4BAA4B,GAAG,IAAI,CAACM,OAAO,GAAGjB,WAAA,CAAAkB,uBAAuB,GAAGlB,WAAA,CAAAY,cAAc;EAC7F;EAEA,IAAaO,WAAWA,CAAA;IACtB,OAAO,iBAA0B;EACnC;EAESC,oBAAoBA,CAACC,UAAsB;IAClD,MAAMC,OAAO,GAAa;MACxBC,eAAe,EAAE,CAAC;MAClBd,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBe,MAAM,EAAE,IAAI,CAACR,SAAS,GAAG;QAAEA,SAAS,EAAE,IAAI,CAACA;MAAS,CAAE,GAAG,EAAE;MAC3DF,QAAQ,EAAE,IAAI,CAACA,QAAQ;MACvBC,qBAAqB,EAAE,IAAI,CAACA;KAC7B;IAED;IACA;IACA,IAAI,IAAAb,OAAA,CAAAuB,cAAc,EAACJ,UAAU,CAAC,IAAI,CAAC,IAAI,IAAI,CAACX,OAAO,CAACgB,OAAO,KAAKC,SAAS,EAAE;MACzEL,OAAO,CAACI,OAAO,GAAG,IAAI,CAAChB,OAAO,CAACgB,OAAO;IACxC;IAEA,OAAOJ,OAAO;EAChB;EAESM,QAAQA,CACfC,QAAgE;IAEhE,OAAOA,QAAQ;EACjB;;AA3DFC,OAAA,CAAAzB,wBAAA,GAAAA,wBAAA;AA0EA,IAAAD,WAAA,CAAA2B,aAAa,EAAC1B,wBAAwB,EAAE,CACtCD,WAAA,CAAA4B,MAAM,CAACC,cAAc,EACrB7B,WAAA,CAAA4B,MAAM,CAACE,SAAS,EAChB9B,WAAA,CAAA4B,MAAM,CAACG,eAAe,EACtB/B,WAAA,CAAA4B,MAAM,CAACI,iBAAiB,CACzB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}