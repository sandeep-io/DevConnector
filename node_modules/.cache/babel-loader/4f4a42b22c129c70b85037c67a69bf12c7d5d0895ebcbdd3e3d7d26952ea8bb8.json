{"ast":null,"code":"'use strict';\n\nmodule.exports = getVirtual;\n\n/*!\n * ignore\n */\n\nfunction getVirtual(schema, name) {\n  if (schema.virtuals[name]) {\n    return {\n      virtual: schema.virtuals[name],\n      path: void 0\n    };\n  }\n  const parts = name.split('.');\n  let cur = '';\n  let nestedSchemaPath = '';\n  for (let i = 0; i < parts.length; ++i) {\n    cur += (cur.length > 0 ? '.' : '') + parts[i];\n    if (schema.virtuals[cur]) {\n      if (i === parts.length - 1) {\n        return {\n          virtual: schema.virtuals[cur],\n          path: nestedSchemaPath\n        };\n      }\n      continue;\n    }\n    if (schema.nested[cur]) {\n      continue;\n    }\n    if (schema.paths[cur] && schema.paths[cur].schema) {\n      schema = schema.paths[cur].schema;\n      const rest = parts.slice(i + 1).join('.');\n      if (schema.virtuals[rest]) {\n        if (i === parts.length - 2) {\n          return {\n            virtual: schema.virtuals[rest],\n            nestedSchemaPath: [nestedSchemaPath, cur].filter(v => !!v).join('.')\n          };\n        }\n        continue;\n      }\n      if (i + 1 < parts.length && schema.discriminators) {\n        for (const key of Object.keys(schema.discriminators)) {\n          const res = getVirtual(schema.discriminators[key], rest);\n          if (res != null) {\n            const _path = [nestedSchemaPath, cur, res.nestedSchemaPath].filter(v => !!v).join('.');\n            return {\n              virtual: res.virtual,\n              nestedSchemaPath: _path\n            };\n          }\n        }\n      }\n      nestedSchemaPath += (nestedSchemaPath.length > 0 ? '.' : '') + cur;\n      cur = '';\n      continue;\n    } else if (schema.paths[cur]?.$isSchemaMap && schema.paths[cur].$__schemaType?.schema) {\n      schema = schema.paths[cur].$__schemaType.schema;\n      ++i;\n      const rest = parts.slice(i + 1).join('.');\n      if (schema.virtuals[rest]) {\n        if (i === parts.length - 2) {\n          return {\n            virtual: schema.virtuals[rest],\n            nestedSchemaPath: [nestedSchemaPath, cur, '$*'].filter(v => !!v).join('.')\n          };\n        }\n        continue;\n      }\n      if (i + 1 < parts.length && schema.discriminators) {\n        for (const key of Object.keys(schema.discriminators)) {\n          const res = getVirtual(schema.discriminators[key], rest);\n          if (res != null) {\n            const _path = [nestedSchemaPath, cur, res.nestedSchemaPath, '$*'].filter(v => !!v).join('.');\n            return {\n              virtual: res.virtual,\n              nestedSchemaPath: _path\n            };\n          }\n        }\n      }\n      nestedSchemaPath += (nestedSchemaPath.length > 0 ? '.' : '') + '$*' + cur;\n      cur = '';\n    }\n    if (schema.discriminators) {\n      for (const discriminatorKey of Object.keys(schema.discriminators)) {\n        const virtualFromDiscriminator = getVirtual(schema.discriminators[discriminatorKey], name);\n        if (virtualFromDiscriminator) return virtualFromDiscriminator;\n      }\n    }\n    return null;\n  }\n}","map":{"version":3,"names":["module","exports","getVirtual","schema","name","virtuals","virtual","path","parts","split","cur","nestedSchemaPath","i","length","nested","paths","rest","slice","join","filter","v","discriminators","key","Object","keys","res","_path","$isSchemaMap","$__schemaType","discriminatorKey","virtualFromDiscriminator"],"sources":["C:/DEVC/node_modules/mongoose/lib/helpers/populate/getVirtual.js"],"sourcesContent":["'use strict';\n\nmodule.exports = getVirtual;\n\n/*!\n * ignore\n */\n\nfunction getVirtual(schema, name) {\n  if (schema.virtuals[name]) {\n    return { virtual: schema.virtuals[name], path: void 0 };\n  }\n\n  const parts = name.split('.');\n  let cur = '';\n  let nestedSchemaPath = '';\n  for (let i = 0; i < parts.length; ++i) {\n    cur += (cur.length > 0 ? '.' : '') + parts[i];\n    if (schema.virtuals[cur]) {\n      if (i === parts.length - 1) {\n        return { virtual: schema.virtuals[cur], path: nestedSchemaPath };\n      }\n      continue;\n    }\n\n    if (schema.nested[cur]) {\n      continue;\n    }\n\n    if (schema.paths[cur] && schema.paths[cur].schema) {\n      schema = schema.paths[cur].schema;\n      const rest = parts.slice(i + 1).join('.');\n\n      if (schema.virtuals[rest]) {\n        if (i === parts.length - 2) {\n          return {\n            virtual: schema.virtuals[rest],\n            nestedSchemaPath: [nestedSchemaPath, cur].filter(v => !!v).join('.')\n          };\n        }\n        continue;\n      }\n\n      if (i + 1 < parts.length && schema.discriminators) {\n        for (const key of Object.keys(schema.discriminators)) {\n          const res = getVirtual(schema.discriminators[key], rest);\n          if (res != null) {\n            const _path = [nestedSchemaPath, cur, res.nestedSchemaPath].\n              filter(v => !!v).join('.');\n            return {\n              virtual: res.virtual,\n              nestedSchemaPath: _path\n            };\n          }\n        }\n      }\n\n      nestedSchemaPath += (nestedSchemaPath.length > 0 ? '.' : '') + cur;\n      cur = '';\n      continue;\n    } else if (schema.paths[cur]?.$isSchemaMap && schema.paths[cur].$__schemaType?.schema) {\n      schema = schema.paths[cur].$__schemaType.schema;\n      ++i;\n      const rest = parts.slice(i + 1).join('.');\n\n      if (schema.virtuals[rest]) {\n        if (i === parts.length - 2) {\n          return {\n            virtual: schema.virtuals[rest],\n            nestedSchemaPath: [nestedSchemaPath, cur, '$*'].filter(v => !!v).join('.')\n          };\n        }\n        continue;\n      }\n\n      if (i + 1 < parts.length && schema.discriminators) {\n        for (const key of Object.keys(schema.discriminators)) {\n          const res = getVirtual(schema.discriminators[key], rest);\n          if (res != null) {\n            const _path = [nestedSchemaPath, cur, res.nestedSchemaPath, '$*'].\n              filter(v => !!v).join('.');\n            return {\n              virtual: res.virtual,\n              nestedSchemaPath: _path\n            };\n          }\n        }\n      }\n\n      nestedSchemaPath += (nestedSchemaPath.length > 0 ? '.' : '') + '$*' + cur;\n      cur = '';\n    }\n\n    if (schema.discriminators) {\n      for (const discriminatorKey of Object.keys(schema.discriminators)) {\n        const virtualFromDiscriminator = getVirtual(schema.discriminators[discriminatorKey], name);\n        if (virtualFromDiscriminator) return virtualFromDiscriminator;\n      }\n    }\n\n    return null;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}