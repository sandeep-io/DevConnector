{"ast":null,"code":"'use strict';\n\nconst isNestedProjection = require('../projection/isNestedProjection');\nmodule.exports = function applyDefaults(doc, fields, exclude, hasIncludedChildren, isBeforeSetters, pathsToSkip, options) {\n  const paths = Object.keys(doc.$__schema.paths);\n  const plen = paths.length;\n  const skipParentChangeTracking = options?.skipParentChangeTracking;\n  for (let i = 0; i < plen; ++i) {\n    let def;\n    let curPath = '';\n    const p = paths[i];\n    if (p === '_id' && doc.$__.skipId) {\n      continue;\n    }\n    const type = doc.$__schema.paths[p];\n    const path = type.splitPath();\n    const len = path.length;\n    if (path[len - 1] === '$*') {\n      continue;\n    }\n    let included = false;\n    let doc_ = doc._doc;\n    for (let j = 0; j < len; ++j) {\n      if (doc_ == null) {\n        break;\n      }\n      const piece = path[j];\n      curPath += (!curPath.length ? '' : '.') + piece;\n      if (exclude === true) {\n        if (curPath in fields) {\n          break;\n        }\n      } else if (exclude === false && fields && !included) {\n        const hasSubpaths = type.$isSingleNested || type.$isMongooseDocumentArray;\n        if (curPath in fields && !isNestedProjection(fields[curPath]) || j === len - 1 && hasSubpaths && hasIncludedChildren != null && hasIncludedChildren[curPath]) {\n          included = true;\n        } else if (hasIncludedChildren != null && !hasIncludedChildren[curPath]) {\n          break;\n        }\n      }\n      if (j === len - 1) {\n        if (doc_[piece] !== void 0) {\n          break;\n        }\n        if (isBeforeSetters != null) {\n          if (typeof type.defaultValue === 'function') {\n            if (!type.defaultValue.$runBeforeSetters && isBeforeSetters) {\n              break;\n            }\n            if (type.defaultValue.$runBeforeSetters && !isBeforeSetters) {\n              break;\n            }\n          } else if (!isBeforeSetters) {\n            // Non-function defaults should always run **before** setters\n            continue;\n          }\n        }\n        if (pathsToSkip && pathsToSkip[curPath]) {\n          break;\n        }\n        if (fields && exclude !== null) {\n          if (exclude === true) {\n            // apply defaults to all non-excluded fields\n            if (p in fields) {\n              continue;\n            }\n            try {\n              def = type.getDefault(doc, false);\n            } catch (err) {\n              doc.invalidate(p, err);\n              break;\n            }\n            if (typeof def !== 'undefined') {\n              doc_[piece] = def;\n              applyChangeTracking(doc, p, skipParentChangeTracking);\n            }\n          } else if (included) {\n            // selected field\n            try {\n              def = type.getDefault(doc, false);\n            } catch (err) {\n              doc.invalidate(p, err);\n              break;\n            }\n            if (typeof def !== 'undefined') {\n              doc_[piece] = def;\n              applyChangeTracking(doc, p, skipParentChangeTracking);\n            }\n          }\n        } else {\n          try {\n            def = type.getDefault(doc, false);\n          } catch (err) {\n            doc.invalidate(p, err);\n            break;\n          }\n          if (typeof def !== 'undefined') {\n            doc_[piece] = def;\n            applyChangeTracking(doc, p, skipParentChangeTracking);\n          }\n        }\n      } else {\n        doc_ = doc_[piece];\n      }\n    }\n  }\n};\n\n/*!\n * ignore\n */\n\nfunction applyChangeTracking(doc, fullPath, skipParentChangeTracking) {\n  doc.$__.activePaths.default(fullPath);\n  if (!skipParentChangeTracking && doc.$isSubdocument && doc.$isSingleNested && doc.$parent() != null) {\n    doc.$parent().$__.activePaths.default(doc.$__pathRelativeToParent(fullPath));\n  }\n}","map":{"version":3,"names":["isNestedProjection","require","module","exports","applyDefaults","doc","fields","exclude","hasIncludedChildren","isBeforeSetters","pathsToSkip","options","paths","Object","keys","$__schema","plen","length","skipParentChangeTracking","i","def","curPath","p","$__","skipId","type","path","splitPath","len","included","doc_","_doc","j","piece","hasSubpaths","$isSingleNested","$isMongooseDocumentArray","defaultValue","$runBeforeSetters","getDefault","err","invalidate","applyChangeTracking","fullPath","activePaths","default","$isSubdocument","$parent","$__pathRelativeToParent"],"sources":["C:/DEVC/node_modules/mongoose/lib/helpers/document/applyDefaults.js"],"sourcesContent":["'use strict';\n\nconst isNestedProjection = require('../projection/isNestedProjection');\n\nmodule.exports = function applyDefaults(doc, fields, exclude, hasIncludedChildren, isBeforeSetters, pathsToSkip, options) {\n  const paths = Object.keys(doc.$__schema.paths);\n  const plen = paths.length;\n  const skipParentChangeTracking = options?.skipParentChangeTracking;\n\n  for (let i = 0; i < plen; ++i) {\n    let def;\n    let curPath = '';\n    const p = paths[i];\n\n    if (p === '_id' && doc.$__.skipId) {\n      continue;\n    }\n\n    const type = doc.$__schema.paths[p];\n    const path = type.splitPath();\n    const len = path.length;\n    if (path[len - 1] === '$*') {\n      continue;\n    }\n    let included = false;\n    let doc_ = doc._doc;\n    for (let j = 0; j < len; ++j) {\n      if (doc_ == null) {\n        break;\n      }\n\n      const piece = path[j];\n      curPath += (!curPath.length ? '' : '.') + piece;\n\n      if (exclude === true) {\n        if (curPath in fields) {\n          break;\n        }\n      } else if (exclude === false && fields && !included) {\n        const hasSubpaths = type.$isSingleNested || type.$isMongooseDocumentArray;\n        if ((curPath in fields && !isNestedProjection(fields[curPath])) || (j === len - 1 && hasSubpaths && hasIncludedChildren != null && hasIncludedChildren[curPath])) {\n          included = true;\n        } else if (hasIncludedChildren != null && !hasIncludedChildren[curPath]) {\n          break;\n        }\n      }\n\n      if (j === len - 1) {\n        if (doc_[piece] !== void 0) {\n          break;\n        }\n\n        if (isBeforeSetters != null) {\n          if (typeof type.defaultValue === 'function') {\n            if (!type.defaultValue.$runBeforeSetters && isBeforeSetters) {\n              break;\n            }\n            if (type.defaultValue.$runBeforeSetters && !isBeforeSetters) {\n              break;\n            }\n          } else if (!isBeforeSetters) {\n            // Non-function defaults should always run **before** setters\n            continue;\n          }\n        }\n\n        if (pathsToSkip && pathsToSkip[curPath]) {\n          break;\n        }\n\n        if (fields && exclude !== null) {\n          if (exclude === true) {\n            // apply defaults to all non-excluded fields\n            if (p in fields) {\n              continue;\n            }\n\n            try {\n              def = type.getDefault(doc, false);\n            } catch (err) {\n              doc.invalidate(p, err);\n              break;\n            }\n\n            if (typeof def !== 'undefined') {\n              doc_[piece] = def;\n              applyChangeTracking(doc, p, skipParentChangeTracking);\n            }\n          } else if (included) {\n            // selected field\n            try {\n              def = type.getDefault(doc, false);\n            } catch (err) {\n              doc.invalidate(p, err);\n              break;\n            }\n\n            if (typeof def !== 'undefined') {\n              doc_[piece] = def;\n              applyChangeTracking(doc, p, skipParentChangeTracking);\n            }\n          }\n        } else {\n          try {\n            def = type.getDefault(doc, false);\n          } catch (err) {\n            doc.invalidate(p, err);\n            break;\n          }\n\n          if (typeof def !== 'undefined') {\n            doc_[piece] = def;\n            applyChangeTracking(doc, p, skipParentChangeTracking);\n          }\n        }\n      } else {\n        doc_ = doc_[piece];\n      }\n    }\n  }\n};\n\n/*!\n * ignore\n */\n\nfunction applyChangeTracking(doc, fullPath, skipParentChangeTracking) {\n  doc.$__.activePaths.default(fullPath);\n  if (!skipParentChangeTracking && doc.$isSubdocument && doc.$isSingleNested && doc.$parent() != null) {\n    doc.$parent().$__.activePaths.default(doc.$__pathRelativeToParent(fullPath));\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}