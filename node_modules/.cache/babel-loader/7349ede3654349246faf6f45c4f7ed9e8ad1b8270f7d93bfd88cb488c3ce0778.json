{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.KillCursorsOperation = void 0;\nconst responses_1 = require(\"../cmap/wire_protocol/responses\");\nconst error_1 = require(\"../error\");\nconst operation_1 = require(\"./operation\");\nclass KillCursorsOperation extends operation_1.AbstractOperation {\n  constructor(cursorId, ns, server, options) {\n    super(options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.MongoDBResponse;\n    this.ns = ns;\n    this.cursorId = cursorId;\n    this.server = server;\n  }\n  get commandName() {\n    return 'killCursors';\n  }\n  buildCommand(_connection, _session) {\n    const killCursors = this.ns.collection;\n    if (killCursors == null) {\n      // Cursors should have adopted the namespace returned by MongoDB\n      // which should always defined a collection name (even a pseudo one, ex. db.aggregate())\n      throw new error_1.MongoRuntimeError('A collection name must be determined before killCursors');\n    }\n    const killCursorsCommand = {\n      killCursors,\n      cursors: [this.cursorId]\n    };\n    return killCursorsCommand;\n  }\n  buildOptions(timeoutContext) {\n    return {\n      session: this.session,\n      timeoutContext\n    };\n  }\n  handleError(_error) {\n    // The driver should never emit errors from killCursors, this is spec-ed behavior\n  }\n}\nexports.KillCursorsOperation = KillCursorsOperation;\n(0, operation_1.defineAspects)(KillCursorsOperation, [operation_1.Aspect.MUST_SELECT_SAME_SERVER]);","map":{"version":3,"names":["responses_1","require","error_1","operation_1","KillCursorsOperation","AbstractOperation","constructor","cursorId","ns","server","options","SERVER_COMMAND_RESPONSE_TYPE","MongoDBResponse","commandName","buildCommand","_connection","_session","killCursors","collection","MongoRuntimeError","killCursorsCommand","cursors","buildOptions","timeoutContext","session","handleError","_error","exports","defineAspects","Aspect","MUST_SELECT_SAME_SERVER"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\kill_cursors.ts"],"sourcesContent":["import type { Long } from '../bson';\nimport { type Connection } from '../cmap/connection';\nimport { MongoDBResponse } from '../cmap/wire_protocol/responses';\nimport { type MongoError, MongoRuntimeError } from '../error';\nimport type { Server, ServerCommandOptions } from '../sdam/server';\nimport type { ClientSession } from '../sessions';\nimport { type TimeoutContext } from '../timeout';\nimport { type MongoDBNamespace } from '../utils';\nimport { AbstractOperation, Aspect, defineAspects, type OperationOptions } from './operation';\n\n/**\n * https://www.mongodb.com/docs/manual/reference/command/killCursors/\n * @internal\n */\ninterface KillCursorsCommand {\n  killCursors: string;\n  cursors: Long[];\n  comment?: unknown;\n}\n\nexport class KillCursorsOperation extends AbstractOperation<void> {\n  override SERVER_COMMAND_RESPONSE_TYPE = MongoDBResponse;\n  cursorId: Long;\n\n  constructor(cursorId: Long, ns: MongoDBNamespace, server: Server, options: OperationOptions) {\n    super(options);\n    this.ns = ns;\n    this.cursorId = cursorId;\n    this.server = server;\n  }\n\n  override get commandName() {\n    return 'killCursors' as const;\n  }\n\n  override buildCommand(_connection: Connection, _session?: ClientSession): KillCursorsCommand {\n    const killCursors = this.ns.collection;\n    if (killCursors == null) {\n      // Cursors should have adopted the namespace returned by MongoDB\n      // which should always defined a collection name (even a pseudo one, ex. db.aggregate())\n      throw new MongoRuntimeError('A collection name must be determined before killCursors');\n    }\n\n    const killCursorsCommand: KillCursorsCommand = {\n      killCursors,\n      cursors: [this.cursorId]\n    };\n\n    return killCursorsCommand;\n  }\n\n  override buildOptions(timeoutContext: TimeoutContext): ServerCommandOptions {\n    return {\n      session: this.session,\n      timeoutContext\n    };\n  }\n\n  override handleError(_error: MongoError): void {\n    // The driver should never emit errors from killCursors, this is spec-ed behavior\n  }\n}\n\ndefineAspects(KillCursorsOperation, [Aspect.MUST_SELECT_SAME_SERVER]);\n"],"mappings":";;;;;;AAEA,MAAAA,WAAA,GAAAC,OAAA;AACA,MAAAC,OAAA,GAAAD,OAAA;AAKA,MAAAE,WAAA,GAAAF,OAAA;AAYA,MAAaG,oBAAqB,SAAQD,WAAA,CAAAE,iBAAuB;EAI/DC,YAAYC,QAAc,EAAEC,EAAoB,EAAEC,MAAc,EAAEC,OAAyB;IACzF,KAAK,CAACA,OAAO,CAAC;IAJP,KAAAC,4BAA4B,GAAGX,WAAA,CAAAY,eAAe;IAKrD,IAAI,CAACJ,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACD,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACE,MAAM,GAAGA,MAAM;EACtB;EAEA,IAAaI,WAAWA,CAAA;IACtB,OAAO,aAAsB;EAC/B;EAESC,YAAYA,CAACC,WAAuB,EAAEC,QAAwB;IACrE,MAAMC,WAAW,GAAG,IAAI,CAACT,EAAE,CAACU,UAAU;IACtC,IAAID,WAAW,IAAI,IAAI,EAAE;MACvB;MACA;MACA,MAAM,IAAIf,OAAA,CAAAiB,iBAAiB,CAAC,yDAAyD,CAAC;IACxF;IAEA,MAAMC,kBAAkB,GAAuB;MAC7CH,WAAW;MACXI,OAAO,EAAE,CAAC,IAAI,CAACd,QAAQ;KACxB;IAED,OAAOa,kBAAkB;EAC3B;EAESE,YAAYA,CAACC,cAA8B;IAClD,OAAO;MACLC,OAAO,EAAE,IAAI,CAACA,OAAO;MACrBD;KACD;EACH;EAESE,WAAWA,CAACC,MAAkB;IACrC;EAAA;;AAvCJC,OAAA,CAAAvB,oBAAA,GAAAA,oBAAA;AA2CA,IAAAD,WAAA,CAAAyB,aAAa,EAACxB,oBAAoB,EAAE,CAACD,WAAA,CAAA0B,MAAM,CAACC,uBAAuB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}