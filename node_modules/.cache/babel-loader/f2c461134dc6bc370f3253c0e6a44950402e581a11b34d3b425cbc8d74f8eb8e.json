{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ValidateCollectionOperation = void 0;\nconst responses_1 = require(\"../cmap/wire_protocol/responses\");\nconst error_1 = require(\"../error\");\nconst command_1 = require(\"./command\");\n/** @internal */\nclass ValidateCollectionOperation extends command_1.CommandOperation {\n  constructor(admin, collectionName, options) {\n    super(admin.s.db, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.MongoDBResponse;\n    this.options = options;\n    this.collectionName = collectionName;\n  }\n  get commandName() {\n    return 'validate';\n  }\n  buildCommandDocument(_connection, _session) {\n    // Decorate command with extra options\n    return {\n      validate: this.collectionName,\n      ...Object.fromEntries(Object.entries(this.options).filter(entry => entry[0] !== 'session'))\n    };\n  }\n  handleOk(response) {\n    const result = super.handleOk(response);\n    if (result.result != null && typeof result.result !== 'string') throw new error_1.MongoUnexpectedServerResponseError('Error with validation data');\n    if (result.result != null && result.result.match(/exception|corrupt/) != null) throw new error_1.MongoUnexpectedServerResponseError(`Invalid collection ${this.collectionName}`);\n    if (result.valid != null && !result.valid) throw new error_1.MongoUnexpectedServerResponseError(`Invalid collection ${this.collectionName}`);\n    return response;\n  }\n}\nexports.ValidateCollectionOperation = ValidateCollectionOperation;","map":{"version":3,"names":["responses_1","require","error_1","command_1","ValidateCollectionOperation","CommandOperation","constructor","admin","collectionName","options","s","db","SERVER_COMMAND_RESPONSE_TYPE","MongoDBResponse","commandName","buildCommandDocument","_connection","_session","validate","Object","fromEntries","entries","filter","entry","handleOk","response","result","MongoUnexpectedServerResponseError","match","valid","exports"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\validate_collection.ts"],"sourcesContent":["import { type Connection } from '..';\nimport type { Admin } from '../admin';\nimport { type Document } from '../bson';\nimport { MongoDBResponse } from '../cmap/wire_protocol/responses';\nimport { MongoUnexpectedServerResponseError } from '../error';\nimport type { ClientSession } from '../sessions';\nimport { CommandOperation, type CommandOperationOptions } from './command';\n\n/** @public */\nexport interface ValidateCollectionOptions extends Omit<CommandOperationOptions, 'rawData'> {\n  /** Validates a collection in the background, without interrupting read or write traffic (only in MongoDB 4.4+) */\n  background?: boolean;\n}\n\n/** @internal */\nexport class ValidateCollectionOperation extends CommandOperation<Document> {\n  override SERVER_COMMAND_RESPONSE_TYPE = MongoDBResponse;\n  override options: ValidateCollectionOptions;\n  collectionName: string;\n\n  constructor(admin: Admin, collectionName: string, options: ValidateCollectionOptions) {\n    super(admin.s.db, options);\n    this.options = options;\n    this.collectionName = collectionName;\n  }\n\n  override get commandName() {\n    return 'validate' as const;\n  }\n\n  override buildCommandDocument(_connection: Connection, _session?: ClientSession): Document {\n    // Decorate command with extra options\n    return {\n      validate: this.collectionName,\n      ...Object.fromEntries(Object.entries(this.options).filter(entry => entry[0] !== 'session'))\n    };\n  }\n\n  override handleOk(response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>): Document {\n    const result = super.handleOk(response);\n    if (result.result != null && typeof result.result !== 'string')\n      throw new MongoUnexpectedServerResponseError('Error with validation data');\n    if (result.result != null && result.result.match(/exception|corrupt/) != null)\n      throw new MongoUnexpectedServerResponseError(`Invalid collection ${this.collectionName}`);\n    if (result.valid != null && !result.valid)\n      throw new MongoUnexpectedServerResponseError(`Invalid collection ${this.collectionName}`);\n\n    return response;\n  }\n}\n"],"mappings":";;;;;;AAGA,MAAAA,WAAA,GAAAC,OAAA;AACA,MAAAC,OAAA,GAAAD,OAAA;AAEA,MAAAE,SAAA,GAAAF,OAAA;AAQA;AACA,MAAaG,2BAA4B,SAAQD,SAAA,CAAAE,gBAA0B;EAKzEC,YAAYC,KAAY,EAAEC,cAAsB,EAAEC,OAAkC;IAClF,KAAK,CAACF,KAAK,CAACG,CAAC,CAACC,EAAE,EAAEF,OAAO,CAAC;IALnB,KAAAG,4BAA4B,GAAGZ,WAAA,CAAAa,eAAe;IAMrD,IAAI,CAACJ,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACD,cAAc,GAAGA,cAAc;EACtC;EAEA,IAAaM,WAAWA,CAAA;IACtB,OAAO,UAAmB;EAC5B;EAESC,oBAAoBA,CAACC,WAAuB,EAAEC,QAAwB;IAC7E;IACA,OAAO;MACLC,QAAQ,EAAE,IAAI,CAACV,cAAc;MAC7B,GAAGW,MAAM,CAACC,WAAW,CAACD,MAAM,CAACE,OAAO,CAAC,IAAI,CAACZ,OAAO,CAAC,CAACa,MAAM,CAACC,KAAK,IAAIA,KAAK,CAAC,CAAC,CAAC,KAAK,SAAS,CAAC;KAC3F;EACH;EAESC,QAAQA,CAACC,QAAgE;IAChF,MAAMC,MAAM,GAAG,KAAK,CAACF,QAAQ,CAACC,QAAQ,CAAC;IACvC,IAAIC,MAAM,CAACA,MAAM,IAAI,IAAI,IAAI,OAAOA,MAAM,CAACA,MAAM,KAAK,QAAQ,EAC5D,MAAM,IAAIxB,OAAA,CAAAyB,kCAAkC,CAAC,4BAA4B,CAAC;IAC5E,IAAID,MAAM,CAACA,MAAM,IAAI,IAAI,IAAIA,MAAM,CAACA,MAAM,CAACE,KAAK,CAAC,mBAAmB,CAAC,IAAI,IAAI,EAC3E,MAAM,IAAI1B,OAAA,CAAAyB,kCAAkC,CAAC,sBAAsB,IAAI,CAACnB,cAAc,EAAE,CAAC;IAC3F,IAAIkB,MAAM,CAACG,KAAK,IAAI,IAAI,IAAI,CAACH,MAAM,CAACG,KAAK,EACvC,MAAM,IAAI3B,OAAA,CAAAyB,kCAAkC,CAAC,sBAAsB,IAAI,CAACnB,cAAc,EAAE,CAAC;IAE3F,OAAOiB,QAAQ;EACjB;;AAjCFK,OAAA,CAAA1B,2BAAA,GAAAA,2BAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}