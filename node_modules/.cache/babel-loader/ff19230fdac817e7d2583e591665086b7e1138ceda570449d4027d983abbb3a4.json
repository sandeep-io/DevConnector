{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DropDatabaseOperation = exports.DropCollectionOperation = void 0;\nexports.dropCollections = dropCollections;\nconst __1 = require(\"..\");\nconst responses_1 = require(\"../cmap/wire_protocol/responses\");\nconst abstract_cursor_1 = require(\"../cursor/abstract_cursor\");\nconst error_1 = require(\"../error\");\nconst timeout_1 = require(\"../timeout\");\nconst command_1 = require(\"./command\");\nconst execute_operation_1 = require(\"./execute_operation\");\nconst operation_1 = require(\"./operation\");\n/** @internal */\nclass DropCollectionOperation extends command_1.CommandOperation {\n  constructor(db, name, options = {}) {\n    super(db, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.MongoDBResponse;\n    this.options = options;\n    this.name = name;\n  }\n  get commandName() {\n    return 'drop';\n  }\n  buildCommandDocument(_connection, _session) {\n    return {\n      drop: this.name\n    };\n  }\n  handleOk(_response) {\n    return true;\n  }\n  handleError(error) {\n    if (!(error instanceof __1.MongoServerError)) throw error;\n    if (Number(error.code) !== error_1.MONGODB_ERROR_CODES.NamespaceNotFound) throw error;\n    return false;\n  }\n}\nexports.DropCollectionOperation = DropCollectionOperation;\nasync function dropCollections(db, name, options) {\n  const timeoutContext = timeout_1.TimeoutContext.create({\n    session: options.session,\n    serverSelectionTimeoutMS: db.client.s.options.serverSelectionTimeoutMS,\n    waitQueueTimeoutMS: db.client.s.options.waitQueueTimeoutMS,\n    timeoutMS: options.timeoutMS\n  });\n  const encryptedFieldsMap = db.client.s.options.autoEncryption?.encryptedFieldsMap;\n  let encryptedFields = options.encryptedFields ?? encryptedFieldsMap?.[`${db.databaseName}.${name}`];\n  if (!encryptedFields && encryptedFieldsMap) {\n    // If the MongoClient was configured with an encryptedFieldsMap,\n    // and no encryptedFields config was available in it or explicitly\n    // passed as an argument, the spec tells us to look one up using\n    // listCollections().\n    const listCollectionsResult = await db.listCollections({\n      name\n    }, {\n      nameOnly: false,\n      session: options.session,\n      timeoutContext: new abstract_cursor_1.CursorTimeoutContext(timeoutContext, Symbol())\n    }).toArray();\n    encryptedFields = listCollectionsResult?.[0]?.options?.encryptedFields;\n  }\n  if (encryptedFields) {\n    const escCollection = encryptedFields.escCollection || `enxcol_.${name}.esc`;\n    const ecocCollection = encryptedFields.ecocCollection || `enxcol_.${name}.ecoc`;\n    for (const collectionName of [escCollection, ecocCollection]) {\n      // Drop auxilliary collections, ignoring potential NamespaceNotFound errors.\n      const dropOp = new DropCollectionOperation(db, collectionName, options);\n      await (0, execute_operation_1.executeOperation)(db.client, dropOp, timeoutContext);\n    }\n  }\n  return await (0, execute_operation_1.executeOperation)(db.client, new DropCollectionOperation(db, name, options), timeoutContext);\n}\n/** @internal */\nclass DropDatabaseOperation extends command_1.CommandOperation {\n  constructor(db, options) {\n    super(db, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.MongoDBResponse;\n    this.options = options;\n  }\n  get commandName() {\n    return 'dropDatabase';\n  }\n  buildCommandDocument(_connection, _session) {\n    return {\n      dropDatabase: 1\n    };\n  }\n  handleOk(_response) {\n    return true;\n  }\n}\nexports.DropDatabaseOperation = DropDatabaseOperation;\n(0, operation_1.defineAspects)(DropCollectionOperation, [operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DropDatabaseOperation, [operation_1.Aspect.WRITE_OPERATION]);","map":{"version":3,"names":["exports","dropCollections","__1","require","responses_1","abstract_cursor_1","error_1","timeout_1","command_1","execute_operation_1","operation_1","DropCollectionOperation","CommandOperation","constructor","db","name","options","SERVER_COMMAND_RESPONSE_TYPE","MongoDBResponse","commandName","buildCommandDocument","_connection","_session","drop","handleOk","_response","handleError","error","MongoServerError","Number","code","MONGODB_ERROR_CODES","NamespaceNotFound","timeoutContext","TimeoutContext","create","session","serverSelectionTimeoutMS","client","s","waitQueueTimeoutMS","timeoutMS","encryptedFieldsMap","autoEncryption","encryptedFields","databaseName","listCollectionsResult","listCollections","nameOnly","CursorTimeoutContext","Symbol","toArray","escCollection","ecocCollection","collectionName","dropOp","executeOperation","DropDatabaseOperation","dropDatabase","defineAspects","Aspect","WRITE_OPERATION"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\drop.ts"],"sourcesContent":["import { type Connection, type MongoError, MongoServerError } from '..';\nimport type { Document } from '../bson';\nimport { MongoDBResponse } from '../cmap/wire_protocol/responses';\nimport { CursorTimeoutContext } from '../cursor/abstract_cursor';\nimport type { Db } from '../db';\nimport { MONGODB_ERROR_CODES } from '../error';\nimport type { ClientSession } from '../sessions';\nimport { TimeoutContext } from '../timeout';\nimport { CommandOperation, type CommandOperationOptions } from './command';\nimport { executeOperation } from './execute_operation';\nimport { Aspect, defineAspects } from './operation';\n\n/** @public */\nexport interface DropCollectionOptions extends Omit<CommandOperationOptions, 'rawData'> {\n  /** @experimental */\n  encryptedFields?: Document;\n}\n\n/** @internal */\nexport class DropCollectionOperation extends CommandOperation<boolean> {\n  override SERVER_COMMAND_RESPONSE_TYPE = MongoDBResponse;\n\n  override options: DropCollectionOptions;\n  name: string;\n\n  constructor(db: Db, name: string, options: DropCollectionOptions = {}) {\n    super(db, options);\n    this.options = options;\n    this.name = name;\n  }\n\n  override get commandName() {\n    return 'drop' as const;\n  }\n\n  override buildCommandDocument(_connection: Connection, _session?: ClientSession): Document {\n    return { drop: this.name };\n  }\n\n  override handleOk(_response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>): boolean {\n    return true;\n  }\n\n  override handleError(error: MongoError): boolean {\n    if (!(error instanceof MongoServerError)) throw error;\n    if (Number(error.code) !== MONGODB_ERROR_CODES.NamespaceNotFound) throw error;\n\n    return false;\n  }\n}\n\nexport async function dropCollections(\n  db: Db,\n  name: string,\n  options: DropCollectionOptions\n): Promise<boolean> {\n  const timeoutContext = TimeoutContext.create({\n    session: options.session,\n    serverSelectionTimeoutMS: db.client.s.options.serverSelectionTimeoutMS,\n    waitQueueTimeoutMS: db.client.s.options.waitQueueTimeoutMS,\n    timeoutMS: options.timeoutMS\n  });\n\n  const encryptedFieldsMap = db.client.s.options.autoEncryption?.encryptedFieldsMap;\n  let encryptedFields: Document | undefined =\n    options.encryptedFields ?? encryptedFieldsMap?.[`${db.databaseName}.${name}`];\n\n  if (!encryptedFields && encryptedFieldsMap) {\n    // If the MongoClient was configured with an encryptedFieldsMap,\n    // and no encryptedFields config was available in it or explicitly\n    // passed as an argument, the spec tells us to look one up using\n    // listCollections().\n    const listCollectionsResult = await db\n      .listCollections(\n        { name },\n        {\n          nameOnly: false,\n          session: options.session,\n          timeoutContext: new CursorTimeoutContext(timeoutContext, Symbol())\n        }\n      )\n      .toArray();\n    encryptedFields = listCollectionsResult?.[0]?.options?.encryptedFields;\n  }\n\n  if (encryptedFields) {\n    const escCollection = encryptedFields.escCollection || `enxcol_.${name}.esc`;\n    const ecocCollection = encryptedFields.ecocCollection || `enxcol_.${name}.ecoc`;\n\n    for (const collectionName of [escCollection, ecocCollection]) {\n      // Drop auxilliary collections, ignoring potential NamespaceNotFound errors.\n      const dropOp = new DropCollectionOperation(db, collectionName, options);\n      await executeOperation(db.client, dropOp, timeoutContext);\n    }\n  }\n\n  return await executeOperation(\n    db.client,\n    new DropCollectionOperation(db, name, options),\n    timeoutContext\n  );\n}\n\n/** @public */\nexport type DropDatabaseOptions = CommandOperationOptions;\n\n/** @internal */\nexport class DropDatabaseOperation extends CommandOperation<boolean> {\n  override SERVER_COMMAND_RESPONSE_TYPE = MongoDBResponse;\n  override options: DropDatabaseOptions;\n\n  constructor(db: Db, options: DropDatabaseOptions) {\n    super(db, options);\n    this.options = options;\n  }\n  override get commandName() {\n    return 'dropDatabase' as const;\n  }\n\n  override buildCommandDocument(_connection: Connection, _session?: ClientSession): Document {\n    return { dropDatabase: 1 };\n  }\n\n  override handleOk(_response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>): boolean {\n    return true;\n  }\n}\n\ndefineAspects(DropCollectionOperation, [Aspect.WRITE_OPERATION]);\ndefineAspects(DropDatabaseOperation, [Aspect.WRITE_OPERATION]);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}