{"ast":null,"code":"'use strict';\n\n/*!\n * ignore\n */\nmodule.exports = function saveSubdocs(schema) {\n  const unshift = true;\n  schema.s.hooks.pre('save', false, async function saveSubdocsPreSave() {\n    if (this.$isSubdocument) {\n      return;\n    }\n    const subdocs = this.$getAllSubdocs({\n      useCache: true\n    });\n    if (!subdocs.length) {\n      return;\n    }\n    const options = this.$__.saveOptions;\n    await Promise.all(subdocs.map(subdoc => subdoc._execDocumentPreHooks('save', options)));\n\n    // Invalidate subdocs cache because subdoc pre hooks can add new subdocuments\n    if (this.$__.saveOptions) {\n      this.$__.saveOptions.__subdocs = null;\n    }\n  }, null, unshift);\n  schema.s.hooks.pre('save', async function saveSubdocsPreDeleteOne() {\n    const removedSubdocs = this.$__.removedSubdocs;\n    if (!removedSubdocs?.length) {\n      return;\n    }\n    const promises = [];\n    for (const subdoc of removedSubdocs) {\n      promises.push(subdoc._execDocumentPreHooks('deleteOne'));\n    }\n    await Promise.all(promises);\n  });\n  schema.s.hooks.post('save', async function saveSubdocsPostDeleteOne() {\n    const removedSubdocs = this.$__.removedSubdocs;\n    if (!removedSubdocs?.length) {\n      return;\n    }\n    const promises = [];\n    for (const subdoc of removedSubdocs) {\n      promises.push(subdoc._execDocumentPostHooks('deleteOne'));\n    }\n    this.$__.removedSubdocs = null;\n    await Promise.all(promises);\n  });\n  schema.s.hooks.post('save', async function saveSubdocsPostSave() {\n    if (this.$isSubdocument) {\n      return;\n    }\n    const subdocs = this.$getAllSubdocs({\n      useCache: true\n    });\n    if (!subdocs.length) {\n      return;\n    }\n    const promises = [];\n    for (const subdoc of subdocs) {\n      promises.push(subdoc._execDocumentPostHooks('save'));\n    }\n    await Promise.all(promises);\n  }, null, unshift);\n};","map":{"version":3,"names":["module","exports","saveSubdocs","schema","unshift","s","hooks","pre","saveSubdocsPreSave","$isSubdocument","subdocs","$getAllSubdocs","useCache","length","options","$__","saveOptions","Promise","all","map","subdoc","_execDocumentPreHooks","__subdocs","saveSubdocsPreDeleteOne","removedSubdocs","promises","push","post","saveSubdocsPostDeleteOne","_execDocumentPostHooks","saveSubdocsPostSave"],"sources":["C:/DEVC/node_modules/mongoose/lib/plugins/saveSubdocs.js"],"sourcesContent":["'use strict';\n\n/*!\n * ignore\n */\n\nmodule.exports = function saveSubdocs(schema) {\n  const unshift = true;\n  schema.s.hooks.pre('save', false, async function saveSubdocsPreSave() {\n    if (this.$isSubdocument) {\n      return;\n    }\n\n    const subdocs = this.$getAllSubdocs({ useCache: true });\n\n    if (!subdocs.length) {\n      return;\n    }\n\n    const options = this.$__.saveOptions;\n    await Promise.all(subdocs.map(subdoc => subdoc._execDocumentPreHooks('save', options)));\n\n    // Invalidate subdocs cache because subdoc pre hooks can add new subdocuments\n    if (this.$__.saveOptions) {\n      this.$__.saveOptions.__subdocs = null;\n    }\n  }, null, unshift);\n\n  schema.s.hooks.pre('save', async function saveSubdocsPreDeleteOne() {\n    const removedSubdocs = this.$__.removedSubdocs;\n    if (!removedSubdocs?.length) {\n      return;\n    }\n\n    const promises = [];\n    for (const subdoc of removedSubdocs) {\n      promises.push(subdoc._execDocumentPreHooks('deleteOne'));\n    }\n\n    await Promise.all(promises);\n  });\n\n  schema.s.hooks.post('save', async function saveSubdocsPostDeleteOne() {\n    const removedSubdocs = this.$__.removedSubdocs;\n    if (!removedSubdocs?.length) {\n      return;\n    }\n\n    const promises = [];\n    for (const subdoc of removedSubdocs) {\n      promises.push(subdoc._execDocumentPostHooks('deleteOne'));\n    }\n\n    this.$__.removedSubdocs = null;\n    await Promise.all(promises);\n  });\n\n  schema.s.hooks.post('save', async function saveSubdocsPostSave() {\n    if (this.$isSubdocument) {\n      return;\n    }\n\n    const subdocs = this.$getAllSubdocs({ useCache: true });\n\n    if (!subdocs.length) {\n      return;\n    }\n\n    const promises = [];\n    for (const subdoc of subdocs) {\n      promises.push(subdoc._execDocumentPostHooks('save'));\n    }\n\n    await Promise.all(promises);\n  }, null, unshift);\n};\n"],"mappings":"AAAA,YAAY;;AAEZ;AACA;AACA;AAEAA,MAAM,CAACC,OAAO,GAAG,SAASC,WAAWA,CAACC,MAAM,EAAE;EAC5C,MAAMC,OAAO,GAAG,IAAI;EACpBD,MAAM,CAACE,CAAC,CAACC,KAAK,CAACC,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,eAAeC,kBAAkBA,CAAA,EAAG;IACpE,IAAI,IAAI,CAACC,cAAc,EAAE;MACvB;IACF;IAEA,MAAMC,OAAO,GAAG,IAAI,CAACC,cAAc,CAAC;MAAEC,QAAQ,EAAE;IAAK,CAAC,CAAC;IAEvD,IAAI,CAACF,OAAO,CAACG,MAAM,EAAE;MACnB;IACF;IAEA,MAAMC,OAAO,GAAG,IAAI,CAACC,GAAG,CAACC,WAAW;IACpC,MAAMC,OAAO,CAACC,GAAG,CAACR,OAAO,CAACS,GAAG,CAACC,MAAM,IAAIA,MAAM,CAACC,qBAAqB,CAAC,MAAM,EAAEP,OAAO,CAAC,CAAC,CAAC;;IAEvF;IACA,IAAI,IAAI,CAACC,GAAG,CAACC,WAAW,EAAE;MACxB,IAAI,CAACD,GAAG,CAACC,WAAW,CAACM,SAAS,GAAG,IAAI;IACvC;EACF,CAAC,EAAE,IAAI,EAAElB,OAAO,CAAC;EAEjBD,MAAM,CAACE,CAAC,CAACC,KAAK,CAACC,GAAG,CAAC,MAAM,EAAE,eAAegB,uBAAuBA,CAAA,EAAG;IAClE,MAAMC,cAAc,GAAG,IAAI,CAACT,GAAG,CAACS,cAAc;IAC9C,IAAI,CAACA,cAAc,EAAEX,MAAM,EAAE;MAC3B;IACF;IAEA,MAAMY,QAAQ,GAAG,EAAE;IACnB,KAAK,MAAML,MAAM,IAAII,cAAc,EAAE;MACnCC,QAAQ,CAACC,IAAI,CAACN,MAAM,CAACC,qBAAqB,CAAC,WAAW,CAAC,CAAC;IAC1D;IAEA,MAAMJ,OAAO,CAACC,GAAG,CAACO,QAAQ,CAAC;EAC7B,CAAC,CAAC;EAEFtB,MAAM,CAACE,CAAC,CAACC,KAAK,CAACqB,IAAI,CAAC,MAAM,EAAE,eAAeC,wBAAwBA,CAAA,EAAG;IACpE,MAAMJ,cAAc,GAAG,IAAI,CAACT,GAAG,CAACS,cAAc;IAC9C,IAAI,CAACA,cAAc,EAAEX,MAAM,EAAE;MAC3B;IACF;IAEA,MAAMY,QAAQ,GAAG,EAAE;IACnB,KAAK,MAAML,MAAM,IAAII,cAAc,EAAE;MACnCC,QAAQ,CAACC,IAAI,CAACN,MAAM,CAACS,sBAAsB,CAAC,WAAW,CAAC,CAAC;IAC3D;IAEA,IAAI,CAACd,GAAG,CAACS,cAAc,GAAG,IAAI;IAC9B,MAAMP,OAAO,CAACC,GAAG,CAACO,QAAQ,CAAC;EAC7B,CAAC,CAAC;EAEFtB,MAAM,CAACE,CAAC,CAACC,KAAK,CAACqB,IAAI,CAAC,MAAM,EAAE,eAAeG,mBAAmBA,CAAA,EAAG;IAC/D,IAAI,IAAI,CAACrB,cAAc,EAAE;MACvB;IACF;IAEA,MAAMC,OAAO,GAAG,IAAI,CAACC,cAAc,CAAC;MAAEC,QAAQ,EAAE;IAAK,CAAC,CAAC;IAEvD,IAAI,CAACF,OAAO,CAACG,MAAM,EAAE;MACnB;IACF;IAEA,MAAMY,QAAQ,GAAG,EAAE;IACnB,KAAK,MAAML,MAAM,IAAIV,OAAO,EAAE;MAC5Be,QAAQ,CAACC,IAAI,CAACN,MAAM,CAACS,sBAAsB,CAAC,MAAM,CAAC,CAAC;IACtD;IAEA,MAAMZ,OAAO,CAACC,GAAG,CAACO,QAAQ,CAAC;EAC7B,CAAC,EAAE,IAAI,EAAErB,OAAO,CAAC;AACnB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}