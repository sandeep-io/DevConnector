{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ClientBulkWriteOperation = void 0;\nconst responses_1 = require(\"../../cmap/wire_protocol/responses\");\nconst utils_1 = require(\"../../utils\");\nconst command_1 = require(\"../command\");\nconst operation_1 = require(\"../operation\");\n/**\n * Executes a single client bulk write operation within a potential batch.\n * @internal\n */\nclass ClientBulkWriteOperation extends command_1.CommandOperation {\n  get commandName() {\n    return 'bulkWrite';\n  }\n  constructor(commandBuilder, options) {\n    super(undefined, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.ClientBulkWriteCursorResponse;\n    this.commandBuilder = commandBuilder;\n    this.options = options;\n    this.ns = new utils_1.MongoDBNamespace('admin', '$cmd');\n  }\n  resetBatch() {\n    return this.commandBuilder.resetBatch();\n  }\n  get canRetryWrite() {\n    return this.commandBuilder.isBatchRetryable;\n  }\n  handleOk(response) {\n    return response;\n  }\n  buildCommandDocument(connection, _session) {\n    const command = this.commandBuilder.buildBatch(connection.description.maxMessageSizeBytes, connection.description.maxWriteBatchSize, connection.description.maxBsonObjectSize);\n    // Check _after_ the batch is built if we cannot retry it and override the option.\n    if (!this.canRetryWrite) {\n      this.options.willRetryWrite = false;\n    }\n    return command;\n  }\n}\nexports.ClientBulkWriteOperation = ClientBulkWriteOperation;\n// Skipping the collation as it goes on the individual ops.\n(0, operation_1.defineAspects)(ClientBulkWriteOperation, [operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.SKIP_COLLATION, operation_1.Aspect.CURSOR_CREATING, operation_1.Aspect.RETRYABLE, operation_1.Aspect.COMMAND_BATCHING, operation_1.Aspect.SUPPORTS_RAW_DATA]);","map":{"version":3,"names":["responses_1","require","utils_1","command_1","operation_1","ClientBulkWriteOperation","CommandOperation","commandName","constructor","commandBuilder","options","undefined","SERVER_COMMAND_RESPONSE_TYPE","ClientBulkWriteCursorResponse","ns","MongoDBNamespace","resetBatch","canRetryWrite","isBatchRetryable","handleOk","response","buildCommandDocument","connection","_session","command","buildBatch","description","maxMessageSizeBytes","maxWriteBatchSize","maxBsonObjectSize","willRetryWrite","exports","defineAspects","Aspect","WRITE_OPERATION","SKIP_COLLATION","CURSOR_CREATING","RETRYABLE","COMMAND_BATCHING","SUPPORTS_RAW_DATA"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\client_bulk_write\\client_bulk_write.ts"],"sourcesContent":["import { type Connection } from '../../cmap/connection';\nimport { ClientBulkWriteCursorResponse } from '../../cmap/wire_protocol/responses';\nimport type { ClientSession } from '../../sessions';\nimport { MongoDBNamespace } from '../../utils';\nimport { CommandOperation } from '../command';\nimport { Aspect, defineAspects } from '../operation';\nimport { type ClientBulkWriteCommand, type ClientBulkWriteCommandBuilder } from './command_builder';\nimport { type ClientBulkWriteOptions } from './common';\n\n/**\n * Executes a single client bulk write operation within a potential batch.\n * @internal\n */\nexport class ClientBulkWriteOperation extends CommandOperation<ClientBulkWriteCursorResponse> {\n  override SERVER_COMMAND_RESPONSE_TYPE = ClientBulkWriteCursorResponse;\n\n  commandBuilder: ClientBulkWriteCommandBuilder;\n  override options: ClientBulkWriteOptions;\n\n  override get commandName() {\n    return 'bulkWrite' as const;\n  }\n\n  constructor(commandBuilder: ClientBulkWriteCommandBuilder, options: ClientBulkWriteOptions) {\n    super(undefined, options);\n    this.commandBuilder = commandBuilder;\n    this.options = options;\n    this.ns = new MongoDBNamespace('admin', '$cmd');\n  }\n\n  override resetBatch(): boolean {\n    return this.commandBuilder.resetBatch();\n  }\n\n  override get canRetryWrite(): boolean {\n    return this.commandBuilder.isBatchRetryable;\n  }\n\n  override handleOk(\n    response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>\n  ): ClientBulkWriteCursorResponse {\n    return response;\n  }\n\n  override buildCommandDocument(\n    connection: Connection,\n    _session?: ClientSession\n  ): ClientBulkWriteCommand {\n    const command = this.commandBuilder.buildBatch(\n      connection.description.maxMessageSizeBytes,\n      connection.description.maxWriteBatchSize,\n      connection.description.maxBsonObjectSize\n    );\n\n    // Check _after_ the batch is built if we cannot retry it and override the option.\n    if (!this.canRetryWrite) {\n      this.options.willRetryWrite = false;\n    }\n\n    return command;\n  }\n}\n\n// Skipping the collation as it goes on the individual ops.\ndefineAspects(ClientBulkWriteOperation, [\n  Aspect.WRITE_OPERATION,\n  Aspect.SKIP_COLLATION,\n  Aspect.CURSOR_CREATING,\n  Aspect.RETRYABLE,\n  Aspect.COMMAND_BATCHING,\n  Aspect.SUPPORTS_RAW_DATA\n]);\n"],"mappings":";;;;;;AACA,MAAAA,WAAA,GAAAC,OAAA;AAEA,MAAAC,OAAA,GAAAD,OAAA;AACA,MAAAE,SAAA,GAAAF,OAAA;AACA,MAAAG,WAAA,GAAAH,OAAA;AAIA;;;;AAIA,MAAaI,wBAAyB,SAAQF,SAAA,CAAAG,gBAA+C;EAM3F,IAAaC,WAAWA,CAAA;IACtB,OAAO,WAAoB;EAC7B;EAEAC,YAAYC,cAA6C,EAAEC,OAA+B;IACxF,KAAK,CAACC,SAAS,EAAED,OAAO,CAAC;IAVlB,KAAAE,4BAA4B,GAAGZ,WAAA,CAAAa,6BAA6B;IAWnE,IAAI,CAACJ,cAAc,GAAGA,cAAc;IACpC,IAAI,CAACC,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACI,EAAE,GAAG,IAAIZ,OAAA,CAAAa,gBAAgB,CAAC,OAAO,EAAE,MAAM,CAAC;EACjD;EAESC,UAAUA,CAAA;IACjB,OAAO,IAAI,CAACP,cAAc,CAACO,UAAU,EAAE;EACzC;EAEA,IAAaC,aAAaA,CAAA;IACxB,OAAO,IAAI,CAACR,cAAc,CAACS,gBAAgB;EAC7C;EAESC,QAAQA,CACfC,QAAgE;IAEhE,OAAOA,QAAQ;EACjB;EAESC,oBAAoBA,CAC3BC,UAAsB,EACtBC,QAAwB;IAExB,MAAMC,OAAO,GAAG,IAAI,CAACf,cAAc,CAACgB,UAAU,CAC5CH,UAAU,CAACI,WAAW,CAACC,mBAAmB,EAC1CL,UAAU,CAACI,WAAW,CAACE,iBAAiB,EACxCN,UAAU,CAACI,WAAW,CAACG,iBAAiB,CACzC;IAED;IACA,IAAI,CAAC,IAAI,CAACZ,aAAa,EAAE;MACvB,IAAI,CAACP,OAAO,CAACoB,cAAc,GAAG,KAAK;IACrC;IAEA,OAAON,OAAO;EAChB;;AA/CFO,OAAA,CAAA1B,wBAAA,GAAAA,wBAAA;AAkDA;AACA,IAAAD,WAAA,CAAA4B,aAAa,EAAC3B,wBAAwB,EAAE,CACtCD,WAAA,CAAA6B,MAAM,CAACC,eAAe,EACtB9B,WAAA,CAAA6B,MAAM,CAACE,cAAc,EACrB/B,WAAA,CAAA6B,MAAM,CAACG,eAAe,EACtBhC,WAAA,CAAA6B,MAAM,CAACI,SAAS,EAChBjC,WAAA,CAAA6B,MAAM,CAACK,gBAAgB,EACvBlC,WAAA,CAAA6B,MAAM,CAACM,iBAAiB,CACzB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}