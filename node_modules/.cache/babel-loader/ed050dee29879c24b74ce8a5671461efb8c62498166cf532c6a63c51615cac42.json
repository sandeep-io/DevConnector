{"ast":null,"code":"'use strict';\n\nconst Document = require('../document');\nconst internalToObjectOptions = require('../options').internalToObjectOptions;\nconst util = require('util');\nconst utils = require('../utils');\nmodule.exports = Subdocument;\n\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields, parent, options) {\n  if (parent != null) {\n    // If setting a nested path, should copy isNew from parent re: gh-7048\n    const parentOptions = {\n      isNew: parent.isNew\n    };\n    if ('defaults' in parent.$__) {\n      parentOptions.defaults = parent.$__.defaults;\n    }\n    options = Object.assign(parentOptions, options);\n  }\n  if (options?.path != null) {\n    this.$basePath = options.path;\n  }\n  if (options?.pathRelativeToParent != null) {\n    this.$pathRelativeToParent = options.pathRelativeToParent;\n  }\n\n  // Don't pass `path` to Document constructor: path is used for storing the\n  // absolute path to this schematype relative to the top-level document, but\n  // subdocuments use relative paths (relative to the parent document) to track changes.\n  // This avoids the subdocument's fields receiving the subdocument's path as options.path.\n  let documentOptions = options;\n  if (options?.path != null) {\n    documentOptions = Object.assign({}, options);\n    delete documentOptions.path;\n  }\n  Document.call(this, value, fields, documentOptions);\n  delete this.$__.priorDoc;\n}\nSubdocument.prototype = Object.create(Document.prototype);\nObject.defineProperty(Subdocument.prototype, '$isSubdocument', {\n  configurable: false,\n  writable: false,\n  value: true\n});\nObject.defineProperty(Subdocument.prototype, '$isSingleNested', {\n  configurable: false,\n  writable: false,\n  value: true\n});\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.toBSON = function () {\n  return this.toObject(internalToObjectOptions);\n};\n\n/**\n * Used as a stub for middleware\n *\n * #### Note:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nSubdocument.prototype.save = async function save(options) {\n  options = options || {};\n  if (!options.suppressWarning) {\n    utils.warn('mongoose: calling `save()` on a subdoc does **not** save ' + 'the document to MongoDB, it only runs save middleware. ' + 'Use `subdoc.save({ suppressWarning: true })` to hide this warning ' + 'if you\\'re sure this behavior is right for your app.');\n  }\n  return await this.$__save();\n};\n\n/**\n * Given a path relative to this document, return the path relative\n * to the top-level document.\n * @param {String} path\n * @method $__fullPath\n * @memberOf Subdocument\n * @instance\n * @returns {String}\n * @api private\n */\n\nSubdocument.prototype.$__fullPath = function (path) {\n  if (!this.$__.fullPath) {\n    this.ownerDocument();\n  }\n  return path ? this.$__.fullPath + '.' + path : this.$__.fullPath;\n};\n\n/**\n * Given a path relative to this document, return the path relative\n * to the parent document.\n * @param {String} p\n * @returns {String}\n * @method $__pathRelativeToParent\n * @memberOf Subdocument\n * @instance\n * @api private\n */\n\nSubdocument.prototype.$__pathRelativeToParent = function (p) {\n  // If this subdocument has a stored relative path (set by map when subdoc is created),\n  // use it directly to avoid string operations\n  if (this.$pathRelativeToParent != null) {\n    return p == null ? this.$pathRelativeToParent : this.$pathRelativeToParent + '.' + p;\n  }\n  if (p == null) {\n    return this.$basePath;\n  }\n  if (!this.$basePath) {\n    return p;\n  }\n  return [this.$basePath, p].join('.');\n};\n\n/**\n * Used as a stub for middleware\n *\n * #### Note:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @method $__save\n * @api private\n */\n\nSubdocument.prototype.$__save = async function $__save() {\n  try {\n    await this._execDocumentPreHooks('save');\n  } catch (error) {\n    await this._execDocumentPostHooks('save', error);\n    return;\n  }\n  await this._execDocumentPostHooks('save');\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.$isValid = function (path) {\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    return parent.$isValid(fullPath);\n  }\n  return Document.prototype.$isValid.call(this, path);\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.markModified = function (path) {\n  Document.prototype.markModified.call(this, path);\n  const parent = this.$parent();\n  if (parent == null) {\n    return;\n  }\n  const pathToMark = this.$__pathRelativeToParent(path);\n  if (pathToMark == null) {\n    return;\n  }\n  const myPath = this.$__pathRelativeToParent().replace(/\\.$/, '');\n  if (parent.isDirectModified(myPath) || this.isNew) {\n    return;\n  }\n  this.$__parent.markModified(pathToMark, this);\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.isModified = function (paths, options, modifiedPaths) {\n  const parent = this.$parent();\n  if (parent != null) {\n    if (Array.isArray(paths) || typeof paths === 'string') {\n      paths = Array.isArray(paths) ? paths : paths.split(' ');\n      paths = paths.map(p => this.$__pathRelativeToParent(p)).filter(p => p != null);\n    } else if (!paths) {\n      paths = this.$__pathRelativeToParent();\n    }\n    return parent.$isModified(paths, options, modifiedPaths);\n  }\n  return Document.prototype.isModified.call(this, paths, options, modifiedPaths);\n};\n\n/**\n * Marks a path as valid, removing existing validation errors.\n *\n * @param {String} path the field to mark as valid\n * @api private\n * @method $markValid\n * @memberOf Subdocument\n */\n\nSubdocument.prototype.$markValid = function (path) {\n  Document.prototype.$markValid.call(this, path);\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    parent.$markValid(fullPath);\n  }\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.invalidate = function (path, err, val) {\n  Document.prototype.invalidate.call(this, path, err, val);\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    parent.invalidate(fullPath, err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError' || fullPath == null) {\n    throw err;\n  }\n  return this.ownerDocument().$__.validationError;\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.$ignore = function (path) {\n  Document.prototype.$ignore.call(this, path);\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    parent.$ignore(fullPath);\n  }\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nSubdocument.prototype.ownerDocument = function () {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n  let parent = this;\n  const paths = [];\n  const seenDocs = new Set([parent]);\n  while (true) {\n    if (typeof parent.$__pathRelativeToParent !== 'function') {\n      break;\n    }\n    paths.unshift(parent.$__pathRelativeToParent(void 0, true));\n    const _parent = parent.$parent();\n    if (_parent == null) {\n      break;\n    }\n    parent = _parent;\n    if (seenDocs.has(parent)) {\n      throw new Error('Infinite subdocument loop: subdoc with _id ' + parent._id + ' is a parent of itself');\n    }\n    seenDocs.add(parent);\n  }\n  this.$__.fullPath = paths.join('.');\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.$__fullPathWithIndexes = function () {\n  let parent = this;\n  const paths = [];\n  const seenDocs = new Set([parent]);\n  while (true) {\n    if (typeof parent.$__pathRelativeToParent !== 'function') {\n      break;\n    }\n    paths.unshift(parent.$__pathRelativeToParent(void 0, false));\n    const _parent = parent.$parent();\n    if (_parent == null) {\n      break;\n    }\n    parent = _parent;\n    if (seenDocs.has(parent)) {\n      throw new Error('Infinite subdocument loop: subdoc with _id ' + parent._id + ' is a parent of itself');\n    }\n    seenDocs.add(parent);\n  }\n  return paths.join('.');\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nSubdocument.prototype.parent = function () {\n  return this.$__parent;\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n * @method $parent\n */\n\nSubdocument.prototype.$parent = Subdocument.prototype.parent;\n\n/*!\n * Sets this sub-documents parent document.\n *\n * @api private\n */\n\nSubdocument.prototype.$__setParent = function $__setParent(parent) {\n  this.$__parent = parent;\n};\n\n/**\n * ignore\n * @method $__removeFromParent\n * @memberOf Subdocument\n * @instance\n * @api private\n */\n\nSubdocument.prototype.$__removeFromParent = function () {\n  this.$__parent.set(this.$basePath, null);\n};\n\n/**\n * Null-out this subdoc\n *\n * @param {Object} [options]\n */\n\nSubdocument.prototype.deleteOne = function deleteOne(options) {\n  registerRemoveListener(this);\n\n  // If removing entire doc, no need to remove subdoc\n  if (!options?.noop) {\n    this.$__removeFromParent();\n    const owner = this.ownerDocument();\n    owner.$__.removedSubdocs = owner.$__.removedSubdocs || [];\n    owner.$__.removedSubdocs.push(this);\n  }\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.populate = function () {\n  throw new Error('Mongoose does not support calling populate() on nested ' + 'docs. Instead of `doc.nested.populate(\"path\")`, use ' + '`doc.populate(\"nested.path\")`');\n};\n\n/**\n * Helper for console.log\n *\n * @api public\n */\n\nSubdocument.prototype.inspect = function () {\n  return this.toObject();\n};\nif (util.inspect.custom) {\n  // Avoid Node deprecation warning DEP0079\n  Subdocument.prototype[util.inspect.custom] = Subdocument.prototype.inspect;\n}\n\n/**\n * Override `$toObject()` to handle minimizing the whole path. Should not minimize if schematype-level minimize\n * is set to false re: gh-11247, gh-14058, gh-14151\n */\n\nSubdocument.prototype.$toObject = function $toObject(options, json) {\n  const ret = Document.prototype.$toObject.call(this, options, json);\n\n  // If `$toObject()` was called recursively, respect the minimize option, including schematype level minimize.\n  // If minimize is set, then we can minimize out the whole object.\n  if (utils.hasOwnKeys(ret) === false && options?._calledWithOptions != null) {\n    const minimize = options._calledWithOptions?.minimize ?? this?.$__schemaTypeOptions?.minimize ?? options.minimize;\n    if (minimize && !this.constructor.$__required) {\n      return undefined;\n    }\n  }\n  return ret;\n};\n\n/**\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {Subdocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  const owner = sub.ownerDocument();\n  function emitRemove() {\n    owner.$removeListener('save', emitRemove);\n    owner.$removeListener('deleteOne', emitRemove);\n    sub.emit('deleteOne', sub);\n    sub.constructor.emit('deleteOne', sub);\n  }\n  owner.$on('save', emitRemove);\n  owner.$on('deleteOne', emitRemove);\n}","map":{"version":3,"names":["Document","require","internalToObjectOptions","util","utils","module","exports","Subdocument","value","fields","parent","options","parentOptions","isNew","$__","defaults","Object","assign","path","$basePath","pathRelativeToParent","$pathRelativeToParent","documentOptions","call","priorDoc","prototype","create","defineProperty","configurable","writable","toBSON","toObject","save","suppressWarning","warn","$__save","$__fullPath","fullPath","ownerDocument","$__pathRelativeToParent","p","join","_execDocumentPreHooks","error","_execDocumentPostHooks","$isValid","$parent","markModified","pathToMark","myPath","replace","isDirectModified","$__parent","isModified","paths","modifiedPaths","Array","isArray","split","map","filter","$isModified","$markValid","invalidate","err","val","kind","name","validationError","$ignore","seenDocs","Set","unshift","_parent","has","Error","_id","add","$__fullPathWithIndexes","$__setParent","$__removeFromParent","set","deleteOne","registerRemoveListener","noop","owner","removedSubdocs","push","populate","inspect","custom","$toObject","json","ret","hasOwnKeys","_calledWithOptions","minimize","$__schemaTypeOptions","constructor","$__required","undefined","sub","emitRemove","$removeListener","emit","$on"],"sources":["C:/DEVC/node_modules/mongoose/lib/types/subdocument.js"],"sourcesContent":["'use strict';\n\nconst Document = require('../document');\nconst internalToObjectOptions = require('../options').internalToObjectOptions;\nconst util = require('util');\nconst utils = require('../utils');\n\nmodule.exports = Subdocument;\n\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields, parent, options) {\n  if (parent != null) {\n    // If setting a nested path, should copy isNew from parent re: gh-7048\n    const parentOptions = { isNew: parent.isNew };\n    if ('defaults' in parent.$__) {\n      parentOptions.defaults = parent.$__.defaults;\n    }\n    options = Object.assign(parentOptions, options);\n  }\n  if (options?.path != null) {\n    this.$basePath = options.path;\n  }\n  if (options?.pathRelativeToParent != null) {\n    this.$pathRelativeToParent = options.pathRelativeToParent;\n  }\n\n  // Don't pass `path` to Document constructor: path is used for storing the\n  // absolute path to this schematype relative to the top-level document, but\n  // subdocuments use relative paths (relative to the parent document) to track changes.\n  // This avoids the subdocument's fields receiving the subdocument's path as options.path.\n  let documentOptions = options;\n  if (options?.path != null) {\n    documentOptions = Object.assign({}, options);\n    delete documentOptions.path;\n  }\n\n  Document.call(this, value, fields, documentOptions);\n\n  delete this.$__.priorDoc;\n}\n\nSubdocument.prototype = Object.create(Document.prototype);\n\nObject.defineProperty(Subdocument.prototype, '$isSubdocument', {\n  configurable: false,\n  writable: false,\n  value: true\n});\n\nObject.defineProperty(Subdocument.prototype, '$isSingleNested', {\n  configurable: false,\n  writable: false,\n  value: true\n});\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.toBSON = function() {\n  return this.toObject(internalToObjectOptions);\n};\n\n/**\n * Used as a stub for middleware\n *\n * #### Note:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nSubdocument.prototype.save = async function save(options) {\n  options = options || {};\n\n  if (!options.suppressWarning) {\n    utils.warn('mongoose: calling `save()` on a subdoc does **not** save ' +\n      'the document to MongoDB, it only runs save middleware. ' +\n      'Use `subdoc.save({ suppressWarning: true })` to hide this warning ' +\n      'if you\\'re sure this behavior is right for your app.');\n  }\n\n  return await this.$__save();\n};\n\n/**\n * Given a path relative to this document, return the path relative\n * to the top-level document.\n * @param {String} path\n * @method $__fullPath\n * @memberOf Subdocument\n * @instance\n * @returns {String}\n * @api private\n */\n\nSubdocument.prototype.$__fullPath = function(path) {\n  if (!this.$__.fullPath) {\n    this.ownerDocument();\n  }\n\n  return path ?\n    this.$__.fullPath + '.' + path :\n    this.$__.fullPath;\n};\n\n/**\n * Given a path relative to this document, return the path relative\n * to the parent document.\n * @param {String} p\n * @returns {String}\n * @method $__pathRelativeToParent\n * @memberOf Subdocument\n * @instance\n * @api private\n */\n\nSubdocument.prototype.$__pathRelativeToParent = function(p) {\n  // If this subdocument has a stored relative path (set by map when subdoc is created),\n  // use it directly to avoid string operations\n  if (this.$pathRelativeToParent != null) {\n    return p == null ? this.$pathRelativeToParent : this.$pathRelativeToParent + '.' + p;\n  }\n\n  if (p == null) {\n    return this.$basePath;\n  }\n  if (!this.$basePath) {\n    return p;\n  }\n  return [this.$basePath, p].join('.');\n};\n\n/**\n * Used as a stub for middleware\n *\n * #### Note:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @method $__save\n * @api private\n */\n\nSubdocument.prototype.$__save = async function $__save() {\n  try {\n    await this._execDocumentPreHooks('save');\n  } catch (error) {\n    await this._execDocumentPostHooks('save', error);\n    return;\n  }\n\n  await this._execDocumentPostHooks('save');\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.$isValid = function(path) {\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    return parent.$isValid(fullPath);\n  }\n  return Document.prototype.$isValid.call(this, path);\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.markModified = function(path) {\n  Document.prototype.markModified.call(this, path);\n  const parent = this.$parent();\n\n  if (parent == null) {\n    return;\n  }\n\n  const pathToMark = this.$__pathRelativeToParent(path);\n  if (pathToMark == null) {\n    return;\n  }\n\n  const myPath = this.$__pathRelativeToParent().replace(/\\.$/, '');\n  if (parent.isDirectModified(myPath) || this.isNew) {\n    return;\n  }\n\n  this.$__parent.markModified(pathToMark, this);\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.isModified = function(paths, options, modifiedPaths) {\n  const parent = this.$parent();\n  if (parent != null) {\n    if (Array.isArray(paths) || typeof paths === 'string') {\n      paths = (Array.isArray(paths) ? paths : paths.split(' '));\n      paths = paths.map(p => this.$__pathRelativeToParent(p)).filter(p => p != null);\n    } else if (!paths) {\n      paths = this.$__pathRelativeToParent();\n    }\n\n    return parent.$isModified(paths, options, modifiedPaths);\n  }\n\n  return Document.prototype.isModified.call(this, paths, options, modifiedPaths);\n};\n\n/**\n * Marks a path as valid, removing existing validation errors.\n *\n * @param {String} path the field to mark as valid\n * @api private\n * @method $markValid\n * @memberOf Subdocument\n */\n\nSubdocument.prototype.$markValid = function(path) {\n  Document.prototype.$markValid.call(this, path);\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    parent.$markValid(fullPath);\n  }\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.invalidate = function(path, err, val) {\n  Document.prototype.invalidate.call(this, path, err, val);\n\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    parent.invalidate(fullPath, err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError' || fullPath == null) {\n    throw err;\n  }\n\n  return this.ownerDocument().$__.validationError;\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.$ignore = function(path) {\n  Document.prototype.$ignore.call(this, path);\n  const parent = this.$parent();\n  const fullPath = this.$__pathRelativeToParent(path);\n  if (parent != null && fullPath != null) {\n    parent.$ignore(fullPath);\n  }\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nSubdocument.prototype.ownerDocument = function() {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  let parent = this;\n  const paths = [];\n  const seenDocs = new Set([parent]);\n\n  while (true) {\n    if (typeof parent.$__pathRelativeToParent !== 'function') {\n      break;\n    }\n    paths.unshift(parent.$__pathRelativeToParent(void 0, true));\n    const _parent = parent.$parent();\n    if (_parent == null) {\n      break;\n    }\n    parent = _parent;\n    if (seenDocs.has(parent)) {\n      throw new Error('Infinite subdocument loop: subdoc with _id ' + parent._id + ' is a parent of itself');\n    }\n\n    seenDocs.add(parent);\n  }\n\n  this.$__.fullPath = paths.join('.');\n\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.$__fullPathWithIndexes = function() {\n  let parent = this;\n  const paths = [];\n  const seenDocs = new Set([parent]);\n\n  while (true) {\n    if (typeof parent.$__pathRelativeToParent !== 'function') {\n      break;\n    }\n    paths.unshift(parent.$__pathRelativeToParent(void 0, false));\n    const _parent = parent.$parent();\n    if (_parent == null) {\n      break;\n    }\n    parent = _parent;\n    if (seenDocs.has(parent)) {\n      throw new Error('Infinite subdocument loop: subdoc with _id ' + parent._id + ' is a parent of itself');\n    }\n\n    seenDocs.add(parent);\n  }\n\n  return paths.join('.');\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nSubdocument.prototype.parent = function() {\n  return this.$__parent;\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n * @method $parent\n */\n\nSubdocument.prototype.$parent = Subdocument.prototype.parent;\n\n/*!\n * Sets this sub-documents parent document.\n *\n * @api private\n */\n\nSubdocument.prototype.$__setParent = function $__setParent(parent) {\n  this.$__parent = parent;\n};\n\n/**\n * ignore\n * @method $__removeFromParent\n * @memberOf Subdocument\n * @instance\n * @api private\n */\n\nSubdocument.prototype.$__removeFromParent = function() {\n  this.$__parent.set(this.$basePath, null);\n};\n\n/**\n * Null-out this subdoc\n *\n * @param {Object} [options]\n */\n\nSubdocument.prototype.deleteOne = function deleteOne(options) {\n  registerRemoveListener(this);\n\n  // If removing entire doc, no need to remove subdoc\n  if (!options?.noop) {\n    this.$__removeFromParent();\n\n    const owner = this.ownerDocument();\n    owner.$__.removedSubdocs = owner.$__.removedSubdocs || [];\n    owner.$__.removedSubdocs.push(this);\n  }\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.populate = function() {\n  throw new Error('Mongoose does not support calling populate() on nested ' +\n    'docs. Instead of `doc.nested.populate(\"path\")`, use ' +\n    '`doc.populate(\"nested.path\")`');\n};\n\n/**\n * Helper for console.log\n *\n * @api public\n */\n\nSubdocument.prototype.inspect = function() {\n  return this.toObject();\n};\n\nif (util.inspect.custom) {\n  // Avoid Node deprecation warning DEP0079\n  Subdocument.prototype[util.inspect.custom] = Subdocument.prototype.inspect;\n}\n\n/**\n * Override `$toObject()` to handle minimizing the whole path. Should not minimize if schematype-level minimize\n * is set to false re: gh-11247, gh-14058, gh-14151\n */\n\nSubdocument.prototype.$toObject = function $toObject(options, json) {\n  const ret = Document.prototype.$toObject.call(this, options, json);\n\n  // If `$toObject()` was called recursively, respect the minimize option, including schematype level minimize.\n  // If minimize is set, then we can minimize out the whole object.\n  if (utils.hasOwnKeys(ret) === false && options?._calledWithOptions != null) {\n    const minimize = options._calledWithOptions?.minimize ?? this?.$__schemaTypeOptions?.minimize ?? options.minimize;\n    if (minimize && !this.constructor.$__required) {\n      return undefined;\n    }\n  }\n  return ret;\n};\n\n/**\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {Subdocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  const owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.$removeListener('save', emitRemove);\n    owner.$removeListener('deleteOne', emitRemove);\n    sub.emit('deleteOne', sub);\n    sub.constructor.emit('deleteOne', sub);\n  }\n\n  owner.$on('save', emitRemove);\n  owner.$on('deleteOne', emitRemove);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}