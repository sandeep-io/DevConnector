{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Explain = exports.ExplainVerbosity = void 0;\nexports.validateExplainTimeoutOptions = validateExplainTimeoutOptions;\nexports.decorateWithExplain = decorateWithExplain;\nconst error_1 = require(\"./error\");\n/** @public */\nexports.ExplainVerbosity = Object.freeze({\n  queryPlanner: 'queryPlanner',\n  queryPlannerExtended: 'queryPlannerExtended',\n  executionStats: 'executionStats',\n  allPlansExecution: 'allPlansExecution'\n});\n/** @internal */\nclass Explain {\n  constructor(verbosity, maxTimeMS) {\n    if (typeof verbosity === 'boolean') {\n      this.verbosity = verbosity ? exports.ExplainVerbosity.allPlansExecution : exports.ExplainVerbosity.queryPlanner;\n    } else {\n      this.verbosity = verbosity;\n    }\n    this.maxTimeMS = maxTimeMS;\n  }\n  static fromOptions({\n    explain\n  } = {}) {\n    if (explain == null) return;\n    if (typeof explain === 'boolean' || typeof explain === 'string') {\n      return new Explain(explain);\n    }\n    const {\n      verbosity,\n      maxTimeMS\n    } = explain;\n    return new Explain(verbosity, maxTimeMS);\n  }\n}\nexports.Explain = Explain;\nfunction validateExplainTimeoutOptions(options, explain) {\n  const {\n    maxTimeMS,\n    timeoutMS\n  } = options;\n  if (timeoutMS != null && (maxTimeMS != null || explain?.maxTimeMS != null)) {\n    throw new error_1.MongoAPIError('Cannot use maxTimeMS with timeoutMS for explain commands.');\n  }\n}\n/**\n * Applies an explain to a given command.\n * @internal\n *\n * @param command - the command on which to apply the explain\n * @param options - the options containing the explain verbosity\n */\nfunction decorateWithExplain(command, explain) {\n  const {\n    verbosity,\n    maxTimeMS\n  } = explain;\n  const baseCommand = {\n    explain: command,\n    verbosity\n  };\n  if (typeof maxTimeMS === 'number') {\n    baseCommand.maxTimeMS = maxTimeMS;\n  }\n  return baseCommand;\n}","map":{"version":3,"names":["exports","validateExplainTimeoutOptions","decorateWithExplain","error_1","require","ExplainVerbosity","Object","freeze","queryPlanner","queryPlannerExtended","executionStats","allPlansExecution","Explain","constructor","verbosity","maxTimeMS","fromOptions","explain","options","timeoutMS","MongoAPIError","command","baseCommand"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\explain.ts"],"sourcesContent":["import { type Document } from './bson';\nimport { MongoAPIError } from './error';\n\n/** @public */\nexport const ExplainVerbosity = Object.freeze({\n  queryPlanner: 'queryPlanner',\n  queryPlannerExtended: 'queryPlannerExtended',\n  executionStats: 'executionStats',\n  allPlansExecution: 'allPlansExecution'\n} as const);\n\n/** @public */\nexport type ExplainVerbosity = string;\n\n/**\n * For backwards compatibility, true is interpreted as \"allPlansExecution\"\n * and false as \"queryPlanner\".\n * @public\n */\nexport type ExplainVerbosityLike = ExplainVerbosity | boolean;\n\n/** @public */\nexport interface ExplainCommandOptions {\n  /** The explain verbosity for the command. */\n  verbosity: ExplainVerbosity;\n  /** The maxTimeMS setting for the command. */\n  maxTimeMS?: number;\n}\n\n/**\n * @public\n *\n * When set, this configures an explain command.  Valid values are boolean (for legacy compatibility,\n * see {@link ExplainVerbosityLike}), a string containing the explain verbosity, or an object containing the verbosity and\n * an optional maxTimeMS.\n *\n * Examples of valid usage:\n *\n * ```typescript\n * collection.find({ name: 'john doe' }, { explain: true });\n * collection.find({ name: 'john doe' }, { explain: false });\n * collection.find({ name: 'john doe' }, { explain: 'queryPlanner' });\n * collection.find({ name: 'john doe' }, { explain: { verbosity: 'queryPlanner' } });\n * ```\n *\n * maxTimeMS can be configured to limit the amount of time the server\n * spends executing an explain by providing an object:\n *\n * ```typescript\n * // limits the `explain` command to no more than 2 seconds\n * collection.find({ name: 'john doe' }, {\n *   explain:  {\n *    verbosity: 'queryPlanner',\n *    maxTimeMS: 2000\n *  }\n * });\n * ```\n */\nexport interface ExplainOptions {\n  /** Specifies the verbosity mode for the explain output. */\n  explain?: ExplainVerbosityLike | ExplainCommandOptions;\n}\n\n/** @internal */\nexport class Explain {\n  readonly verbosity: ExplainVerbosity;\n  readonly maxTimeMS?: number;\n\n  private constructor(verbosity: ExplainVerbosityLike, maxTimeMS?: number) {\n    if (typeof verbosity === 'boolean') {\n      this.verbosity = verbosity\n        ? ExplainVerbosity.allPlansExecution\n        : ExplainVerbosity.queryPlanner;\n    } else {\n      this.verbosity = verbosity;\n    }\n\n    this.maxTimeMS = maxTimeMS;\n  }\n\n  static fromOptions({ explain }: ExplainOptions = {}): Explain | undefined {\n    if (explain == null) return;\n\n    if (typeof explain === 'boolean' || typeof explain === 'string') {\n      return new Explain(explain);\n    }\n\n    const { verbosity, maxTimeMS } = explain;\n    return new Explain(verbosity, maxTimeMS);\n  }\n}\n\nexport function validateExplainTimeoutOptions(options: Document, explain?: Explain) {\n  const { maxTimeMS, timeoutMS } = options;\n  if (timeoutMS != null && (maxTimeMS != null || explain?.maxTimeMS != null)) {\n    throw new MongoAPIError('Cannot use maxTimeMS with timeoutMS for explain commands.');\n  }\n}\n\n/**\n * Applies an explain to a given command.\n * @internal\n *\n * @param command - the command on which to apply the explain\n * @param options - the options containing the explain verbosity\n */\nexport function decorateWithExplain(\n  command: Document,\n  explain: Explain\n): {\n  explain: Document;\n  verbosity: ExplainVerbosity;\n  maxTimeMS?: number;\n} {\n  type ExplainCommand = ReturnType<typeof decorateWithExplain>;\n  const { verbosity, maxTimeMS } = explain;\n  const baseCommand: ExplainCommand = { explain: command, verbosity };\n\n  if (typeof maxTimeMS === 'number') {\n    baseCommand.maxTimeMS = maxTimeMS;\n  }\n\n  return baseCommand;\n}\n"],"mappings":";;;;;;AA4FAA,OAAA,CAAAC,6BAAA,GAAAA,6BAAA;AAcAD,OAAA,CAAAE,mBAAA,GAAAA,mBAAA;AAzGA,MAAAC,OAAA,GAAAC,OAAA;AAEA;AACaJ,OAAA,CAAAK,gBAAgB,GAAGC,MAAM,CAACC,MAAM,CAAC;EAC5CC,YAAY,EAAE,cAAc;EAC5BC,oBAAoB,EAAE,sBAAsB;EAC5CC,cAAc,EAAE,gBAAgB;EAChCC,iBAAiB,EAAE;CACX,CAAC;AAsDX;AACA,MAAaC,OAAO;EAIlBC,YAAoBC,SAA+B,EAAEC,SAAkB;IACrE,IAAI,OAAOD,SAAS,KAAK,SAAS,EAAE;MAClC,IAAI,CAACA,SAAS,GAAGA,SAAS,GACtBd,OAAA,CAAAK,gBAAgB,CAACM,iBAAiB,GAClCX,OAAA,CAAAK,gBAAgB,CAACG,YAAY;IACnC,CAAC,MAAM;MACL,IAAI,CAACM,SAAS,GAAGA,SAAS;IAC5B;IAEA,IAAI,CAACC,SAAS,GAAGA,SAAS;EAC5B;EAEA,OAAOC,WAAWA,CAAC;IAAEC;EAAO,IAAqB,EAAE;IACjD,IAAIA,OAAO,IAAI,IAAI,EAAE;IAErB,IAAI,OAAOA,OAAO,KAAK,SAAS,IAAI,OAAOA,OAAO,KAAK,QAAQ,EAAE;MAC/D,OAAO,IAAIL,OAAO,CAACK,OAAO,CAAC;IAC7B;IAEA,MAAM;MAAEH,SAAS;MAAEC;IAAS,CAAE,GAAGE,OAAO;IACxC,OAAO,IAAIL,OAAO,CAACE,SAAS,EAAEC,SAAS,CAAC;EAC1C;;AAzBFf,OAAA,CAAAY,OAAA,GAAAA,OAAA;AA4BA,SAAgBX,6BAA6BA,CAACiB,OAAiB,EAAED,OAAiB;EAChF,MAAM;IAAEF,SAAS;IAAEI;EAAS,CAAE,GAAGD,OAAO;EACxC,IAAIC,SAAS,IAAI,IAAI,KAAKJ,SAAS,IAAI,IAAI,IAAIE,OAAO,EAAEF,SAAS,IAAI,IAAI,CAAC,EAAE;IAC1E,MAAM,IAAIZ,OAAA,CAAAiB,aAAa,CAAC,2DAA2D,CAAC;EACtF;AACF;AAEA;;;;;;;AAOA,SAAgBlB,mBAAmBA,CACjCmB,OAAiB,EACjBJ,OAAgB;EAOhB,MAAM;IAAEH,SAAS;IAAEC;EAAS,CAAE,GAAGE,OAAO;EACxC,MAAMK,WAAW,GAAmB;IAAEL,OAAO,EAAEI,OAAO;IAAEP;EAAS,CAAE;EAEnE,IAAI,OAAOC,SAAS,KAAK,QAAQ,EAAE;IACjCO,WAAW,CAACP,SAAS,GAAGA,SAAS;EACnC;EAEA,OAAOO,WAAW;AACpB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}