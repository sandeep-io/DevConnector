{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.callback = void 0;\nconst promises_1 = require(\"fs/promises\");\n/** The fallback file name */\nconst FALLBACK_FILENAME = '/var/run/secrets/kubernetes.io/serviceaccount/token';\n/** The azure environment variable for the file name. */\nconst AZURE_FILENAME = 'AZURE_FEDERATED_TOKEN_FILE';\n/** The AWS environment variable for the file name. */\nconst AWS_FILENAME = 'AWS_WEB_IDENTITY_TOKEN_FILE';\n/**\n * The callback function to be used in the automated callback workflow.\n * @param params - The OIDC callback parameters.\n * @returns The OIDC response.\n */\nconst callback = async () => {\n  let filename;\n  if (process.env[AZURE_FILENAME]) {\n    filename = process.env[AZURE_FILENAME];\n  } else if (process.env[AWS_FILENAME]) {\n    filename = process.env[AWS_FILENAME];\n  } else {\n    filename = FALLBACK_FILENAME;\n  }\n  const token = await (0, promises_1.readFile)(filename, 'utf8');\n  return {\n    accessToken: token\n  };\n};\nexports.callback = callback;","map":{"version":3,"names":["promises_1","require","FALLBACK_FILENAME","AZURE_FILENAME","AWS_FILENAME","callback","filename","process","env","token","readFile","accessToken","exports"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\cmap\\auth\\mongodb_oidc\\k8s_machine_workflow.ts"],"sourcesContent":["import { readFile } from 'fs/promises';\n\nimport type { OIDCCallbackFunction, OIDCResponse } from '../mongodb_oidc';\n\n/** The fallback file name */\nconst FALLBACK_FILENAME = '/var/run/secrets/kubernetes.io/serviceaccount/token';\n\n/** The azure environment variable for the file name. */\nconst AZURE_FILENAME = 'AZURE_FEDERATED_TOKEN_FILE';\n\n/** The AWS environment variable for the file name. */\nconst AWS_FILENAME = 'AWS_WEB_IDENTITY_TOKEN_FILE';\n\n/**\n * The callback function to be used in the automated callback workflow.\n * @param params - The OIDC callback parameters.\n * @returns The OIDC response.\n */\nexport const callback: OIDCCallbackFunction = async (): Promise<OIDCResponse> => {\n  let filename: string;\n  if (process.env[AZURE_FILENAME]) {\n    filename = process.env[AZURE_FILENAME];\n  } else if (process.env[AWS_FILENAME]) {\n    filename = process.env[AWS_FILENAME];\n  } else {\n    filename = FALLBACK_FILENAME;\n  }\n  const token = await readFile(filename, 'utf8');\n  return { accessToken: token };\n};\n"],"mappings":";;;;;;AAAA,MAAAA,UAAA,GAAAC,OAAA;AAIA;AACA,MAAMC,iBAAiB,GAAG,qDAAqD;AAE/E;AACA,MAAMC,cAAc,GAAG,4BAA4B;AAEnD;AACA,MAAMC,YAAY,GAAG,6BAA6B;AAElD;;;;;AAKO,MAAMC,QAAQ,GAAyB,MAAAA,CAAA,KAAkC;EAC9E,IAAIC,QAAgB;EACpB,IAAIC,OAAO,CAACC,GAAG,CAACL,cAAc,CAAC,EAAE;IAC/BG,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACL,cAAc,CAAC;EACxC,CAAC,MAAM,IAAII,OAAO,CAACC,GAAG,CAACJ,YAAY,CAAC,EAAE;IACpCE,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACJ,YAAY,CAAC;EACtC,CAAC,MAAM;IACLE,QAAQ,GAAGJ,iBAAiB;EAC9B;EACA,MAAMO,KAAK,GAAG,MAAM,IAAAT,UAAA,CAAAU,QAAQ,EAACJ,QAAQ,EAAE,MAAM,CAAC;EAC9C,OAAO;IAAEK,WAAW,EAAEF;EAAK,CAAE;AAC/B,CAAC;AAXYG,OAAA,CAAAP,QAAQ,GAAAA,QAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}