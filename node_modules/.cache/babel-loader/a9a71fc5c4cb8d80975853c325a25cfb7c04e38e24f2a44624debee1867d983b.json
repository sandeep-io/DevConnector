{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LimitedSizeDocument = void 0;\nexports.isDriverInfoEqual = isDriverInfoEqual;\nexports.makeClientMetadata = makeClientMetadata;\nexports.getFAASEnv = getFAASEnv;\nconst os = require(\"os\");\nconst process = require(\"process\");\nconst bson_1 = require(\"../../bson\");\nconst error_1 = require(\"../../error\");\nconst utils_1 = require(\"../../utils\");\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nconst NODE_DRIVER_VERSION = require('../../../package.json').version;\n/** @internal */\nfunction isDriverInfoEqual(info1, info2) {\n  /** for equality comparison, we consider \"\" as unset */\n  const nonEmptyCmp = (s1, s2) => {\n    s1 ||= undefined;\n    s2 ||= undefined;\n    return s1 === s2;\n  };\n  return nonEmptyCmp(info1.name, info2.name) && nonEmptyCmp(info1.platform, info2.platform) && nonEmptyCmp(info1.version, info2.version);\n}\n/** @internal */\nclass LimitedSizeDocument {\n  constructor(maxSize) {\n    this.document = new Map();\n    /** BSON overhead: Int32 + Null byte */\n    this.documentSize = 5;\n    this.maxSize = maxSize;\n  }\n  /** Only adds key/value if the bsonByteLength is less than MAX_SIZE */\n  ifItFitsItSits(key, value) {\n    // The BSON byteLength of the new element is the same as serializing it to its own document\n    // subtracting the document size int32 and the null terminator.\n    const newElementSize = bson_1.BSON.serialize(new Map().set(key, value)).byteLength - 5;\n    if (newElementSize + this.documentSize > this.maxSize) {\n      return false;\n    }\n    this.documentSize += newElementSize;\n    this.document.set(key, value);\n    return true;\n  }\n  toObject() {\n    return bson_1.BSON.deserialize(bson_1.BSON.serialize(this.document), {\n      promoteLongs: false,\n      promoteBuffers: false,\n      promoteValues: false,\n      useBigInt64: false\n    });\n  }\n}\nexports.LimitedSizeDocument = LimitedSizeDocument;\n/**\n * From the specs:\n * Implementors SHOULD cumulatively update fields in the following order until the document is under the size limit:\n * 1. Omit fields from `env` except `env.name`.\n * 2. Omit fields from `os` except `os.type`.\n * 3. Omit the `env` document entirely.\n * 4. Truncate `platform`. -- special we do not truncate this field\n */\nasync function makeClientMetadata(driverInfoList, {\n  appName = ''\n}) {\n  const metadataDocument = new LimitedSizeDocument(512);\n  // Add app name first, it must be sent\n  if (appName.length > 0) {\n    const name = Buffer.byteLength(appName, 'utf8') <= 128 ? appName : Buffer.from(appName, 'utf8').subarray(0, 128).toString('utf8');\n    metadataDocument.ifItFitsItSits('application', {\n      name\n    });\n  }\n  const driverInfo = {\n    name: 'nodejs',\n    version: NODE_DRIVER_VERSION\n  };\n  // This is where we handle additional driver info added after client construction.\n  for (const {\n    name: n = '',\n    version: v = ''\n  } of driverInfoList) {\n    if (n.length > 0) {\n      driverInfo.name = `${driverInfo.name}|${n}`;\n    }\n    if (v.length > 0) {\n      driverInfo.version = `${driverInfo.version}|${v}`;\n    }\n  }\n  if (!metadataDocument.ifItFitsItSits('driver', driverInfo)) {\n    throw new error_1.MongoInvalidArgumentError('Unable to include driverInfo name and version, metadata cannot exceed 512 bytes');\n  }\n  let runtimeInfo = getRuntimeInfo();\n  // This is where we handle additional driver info added after client construction.\n  for (const {\n    platform = ''\n  } of driverInfoList) {\n    if (platform.length > 0) {\n      runtimeInfo = `${runtimeInfo}|${platform}`;\n    }\n  }\n  if (!metadataDocument.ifItFitsItSits('platform', runtimeInfo)) {\n    throw new error_1.MongoInvalidArgumentError('Unable to include driverInfo platform, metadata cannot exceed 512 bytes');\n  }\n  // Note: order matters, os.type is last so it will be removed last if we're at maxSize\n  const osInfo = new Map().set('name', process.platform).set('architecture', process.arch).set('version', os.release()).set('type', os.type());\n  if (!metadataDocument.ifItFitsItSits('os', osInfo)) {\n    for (const key of osInfo.keys()) {\n      osInfo.delete(key);\n      if (osInfo.size === 0) break;\n      if (metadataDocument.ifItFitsItSits('os', osInfo)) break;\n    }\n  }\n  const faasEnv = getFAASEnv();\n  if (faasEnv != null) {\n    if (!metadataDocument.ifItFitsItSits('env', faasEnv)) {\n      for (const key of faasEnv.keys()) {\n        faasEnv.delete(key);\n        if (faasEnv.size === 0) break;\n        if (metadataDocument.ifItFitsItSits('env', faasEnv)) break;\n      }\n    }\n  }\n  return await addContainerMetadata(metadataDocument.toObject());\n}\nlet dockerPromise;\n/** @internal */\nasync function getContainerMetadata() {\n  dockerPromise ??= (0, utils_1.fileIsAccessible)('/.dockerenv');\n  const isDocker = await dockerPromise;\n  const {\n    KUBERNETES_SERVICE_HOST = ''\n  } = process.env;\n  const isKubernetes = KUBERNETES_SERVICE_HOST.length > 0 ? true : false;\n  const containerMetadata = {};\n  if (isDocker) containerMetadata.runtime = 'docker';\n  if (isKubernetes) containerMetadata.orchestrator = 'kubernetes';\n  return containerMetadata;\n}\n/**\n * @internal\n * Re-add each metadata value.\n * Attempt to add new env container metadata, but keep old data if it does not fit.\n */\nasync function addContainerMetadata(originalMetadata) {\n  const containerMetadata = await getContainerMetadata();\n  if (Object.keys(containerMetadata).length === 0) return originalMetadata;\n  const extendedMetadata = new LimitedSizeDocument(512);\n  const extendedEnvMetadata = {\n    ...originalMetadata?.env,\n    container: containerMetadata\n  };\n  for (const [key, val] of Object.entries(originalMetadata)) {\n    if (key !== 'env') {\n      extendedMetadata.ifItFitsItSits(key, val);\n    } else {\n      if (!extendedMetadata.ifItFitsItSits('env', extendedEnvMetadata)) {\n        // add in old data if newer / extended metadata does not fit\n        extendedMetadata.ifItFitsItSits('env', val);\n      }\n    }\n  }\n  if (!('env' in originalMetadata)) {\n    extendedMetadata.ifItFitsItSits('env', extendedEnvMetadata);\n  }\n  return extendedMetadata.toObject();\n}\n/**\n * Collects FaaS metadata.\n * - `name` MUST be the last key in the Map returned.\n */\nfunction getFAASEnv() {\n  const {\n    AWS_EXECUTION_ENV = '',\n    AWS_LAMBDA_RUNTIME_API = '',\n    FUNCTIONS_WORKER_RUNTIME = '',\n    K_SERVICE = '',\n    FUNCTION_NAME = '',\n    VERCEL = '',\n    AWS_LAMBDA_FUNCTION_MEMORY_SIZE = '',\n    AWS_REGION = '',\n    FUNCTION_MEMORY_MB = '',\n    FUNCTION_REGION = '',\n    FUNCTION_TIMEOUT_SEC = '',\n    VERCEL_REGION = ''\n  } = process.env;\n  const isAWSFaaS = AWS_EXECUTION_ENV.startsWith('AWS_Lambda_') || AWS_LAMBDA_RUNTIME_API.length > 0;\n  const isAzureFaaS = FUNCTIONS_WORKER_RUNTIME.length > 0;\n  const isGCPFaaS = K_SERVICE.length > 0 || FUNCTION_NAME.length > 0;\n  const isVercelFaaS = VERCEL.length > 0;\n  // Note: order matters, name must always be the last key\n  const faasEnv = new Map();\n  // When isVercelFaaS is true so is isAWSFaaS; Vercel inherits the AWS env\n  if (isVercelFaaS && !(isAzureFaaS || isGCPFaaS)) {\n    if (VERCEL_REGION.length > 0) {\n      faasEnv.set('region', VERCEL_REGION);\n    }\n    faasEnv.set('name', 'vercel');\n    return faasEnv;\n  }\n  if (isAWSFaaS && !(isAzureFaaS || isGCPFaaS || isVercelFaaS)) {\n    if (AWS_REGION.length > 0) {\n      faasEnv.set('region', AWS_REGION);\n    }\n    if (AWS_LAMBDA_FUNCTION_MEMORY_SIZE.length > 0 && Number.isInteger(+AWS_LAMBDA_FUNCTION_MEMORY_SIZE)) {\n      faasEnv.set('memory_mb', new bson_1.Int32(AWS_LAMBDA_FUNCTION_MEMORY_SIZE));\n    }\n    faasEnv.set('name', 'aws.lambda');\n    return faasEnv;\n  }\n  if (isAzureFaaS && !(isGCPFaaS || isAWSFaaS || isVercelFaaS)) {\n    faasEnv.set('name', 'azure.func');\n    return faasEnv;\n  }\n  if (isGCPFaaS && !(isAzureFaaS || isAWSFaaS || isVercelFaaS)) {\n    if (FUNCTION_REGION.length > 0) {\n      faasEnv.set('region', FUNCTION_REGION);\n    }\n    if (FUNCTION_MEMORY_MB.length > 0 && Number.isInteger(+FUNCTION_MEMORY_MB)) {\n      faasEnv.set('memory_mb', new bson_1.Int32(FUNCTION_MEMORY_MB));\n    }\n    if (FUNCTION_TIMEOUT_SEC.length > 0 && Number.isInteger(+FUNCTION_TIMEOUT_SEC)) {\n      faasEnv.set('timeout_sec', new bson_1.Int32(FUNCTION_TIMEOUT_SEC));\n    }\n    faasEnv.set('name', 'gcp.func');\n    return faasEnv;\n  }\n  return null;\n}\n/**\n * @internal\n * Get current JavaScript runtime platform\n *\n * NOTE: The version information fetching is intentionally written defensively\n * to avoid having a released driver version that becomes incompatible\n * with a future change to these global objects.\n */\nfunction getRuntimeInfo() {\n  if ('Deno' in globalThis) {\n    const version = typeof Deno?.version?.deno === 'string' ? Deno?.version?.deno : '0.0.0-unknown';\n    return `Deno v${version}, ${os.endianness()}`;\n  }\n  if ('Bun' in globalThis) {\n    const version = typeof Bun?.version === 'string' ? Bun?.version : '0.0.0-unknown';\n    return `Bun v${version}, ${os.endianness()}`;\n  }\n  return `Node.js ${process.version}, ${os.endianness()}`;\n}","map":{"version":3,"names":["exports","isDriverInfoEqual","makeClientMetadata","getFAASEnv","os","require","process","bson_1","error_1","utils_1","NODE_DRIVER_VERSION","version","info1","info2","nonEmptyCmp","s1","s2","undefined","name","platform","LimitedSizeDocument","constructor","maxSize","document","Map","documentSize","ifItFitsItSits","key","value","newElementSize","BSON","serialize","set","byteLength","toObject","deserialize","promoteLongs","promoteBuffers","promoteValues","useBigInt64","driverInfoList","appName","metadataDocument","length","Buffer","from","subarray","toString","driverInfo","n","v","MongoInvalidArgumentError","runtimeInfo","getRuntimeInfo","osInfo","arch","release","type","keys","delete","size","faasEnv","addContainerMetadata","dockerPromise","getContainerMetadata","fileIsAccessible","isDocker","KUBERNETES_SERVICE_HOST","env","isKubernetes","containerMetadata","runtime","orchestrator","originalMetadata","Object","extendedMetadata","extendedEnvMetadata","container","val","entries","AWS_EXECUTION_ENV","AWS_LAMBDA_RUNTIME_API","FUNCTIONS_WORKER_RUNTIME","K_SERVICE","FUNCTION_NAME","VERCEL","AWS_LAMBDA_FUNCTION_MEMORY_SIZE","AWS_REGION","FUNCTION_MEMORY_MB","FUNCTION_REGION","FUNCTION_TIMEOUT_SEC","VERCEL_REGION","isAWSFaaS","startsWith","isAzureFaaS","isGCPFaaS","isVercelFaaS","Number","isInteger","Int32","globalThis","Deno","deno","endianness","Bun"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\cmap\\handshake\\client_metadata.ts"],"sourcesContent":["import * as os from 'os';\nimport * as process from 'process';\n\nimport { BSON, type Document, Int32 } from '../../bson';\nimport { MongoInvalidArgumentError } from '../../error';\nimport type { DriverInfo, MongoOptions } from '../../mongo_client';\nimport { fileIsAccessible } from '../../utils';\n\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nconst NODE_DRIVER_VERSION = require('../../../package.json').version;\n\n/** @internal */\nexport function isDriverInfoEqual(info1: DriverInfo, info2: DriverInfo): boolean {\n  /** for equality comparison, we consider \"\" as unset */\n  const nonEmptyCmp = (s1: string | undefined, s2: string | undefined): boolean => {\n    s1 ||= undefined;\n    s2 ||= undefined;\n\n    return s1 === s2;\n  };\n\n  return (\n    nonEmptyCmp(info1.name, info2.name) &&\n    nonEmptyCmp(info1.platform, info2.platform) &&\n    nonEmptyCmp(info1.version, info2.version)\n  );\n}\n\n/**\n * @internal\n * @see https://github.com/mongodb/specifications/blob/master/source/mongodb-handshake/handshake.md#hello-command\n */\nexport interface ClientMetadata {\n  driver: {\n    name: string;\n    version: string;\n  };\n  os: {\n    type: string;\n    name?: NodeJS.Platform;\n    architecture?: string;\n    version?: string;\n  };\n  platform: string;\n  application?: {\n    name: string;\n  };\n  /** FaaS environment information */\n  env?: {\n    name?: 'aws.lambda' | 'gcp.func' | 'azure.func' | 'vercel';\n    timeout_sec?: Int32;\n    memory_mb?: Int32;\n    region?: string;\n    container?: {\n      runtime?: string;\n      orchestrator?: string;\n    };\n  };\n}\n\n/** @internal */\nexport class LimitedSizeDocument {\n  private document = new Map();\n  /** BSON overhead: Int32 + Null byte */\n  private documentSize = 5;\n  private maxSize: number;\n\n  constructor(maxSize: number) {\n    this.maxSize = maxSize;\n  }\n\n  /** Only adds key/value if the bsonByteLength is less than MAX_SIZE */\n  public ifItFitsItSits(key: string, value: Record<string, any> | string): boolean {\n    // The BSON byteLength of the new element is the same as serializing it to its own document\n    // subtracting the document size int32 and the null terminator.\n    const newElementSize = BSON.serialize(new Map().set(key, value)).byteLength - 5;\n\n    if (newElementSize + this.documentSize > this.maxSize) {\n      return false;\n    }\n\n    this.documentSize += newElementSize;\n\n    this.document.set(key, value);\n\n    return true;\n  }\n\n  toObject(): Document {\n    return BSON.deserialize(BSON.serialize(this.document), {\n      promoteLongs: false,\n      promoteBuffers: false,\n      promoteValues: false,\n      useBigInt64: false\n    });\n  }\n}\n\ntype MakeClientMetadataOptions = Pick<MongoOptions, 'appName'>;\n/**\n * From the specs:\n * Implementors SHOULD cumulatively update fields in the following order until the document is under the size limit:\n * 1. Omit fields from `env` except `env.name`.\n * 2. Omit fields from `os` except `os.type`.\n * 3. Omit the `env` document entirely.\n * 4. Truncate `platform`. -- special we do not truncate this field\n */\nexport async function makeClientMetadata(\n  driverInfoList: DriverInfo[],\n  { appName = '' }: MakeClientMetadataOptions\n): Promise<ClientMetadata> {\n  const metadataDocument = new LimitedSizeDocument(512);\n\n  // Add app name first, it must be sent\n  if (appName.length > 0) {\n    const name =\n      Buffer.byteLength(appName, 'utf8') <= 128\n        ? appName\n        : Buffer.from(appName, 'utf8').subarray(0, 128).toString('utf8');\n    metadataDocument.ifItFitsItSits('application', { name });\n  }\n\n  const driverInfo = {\n    name: 'nodejs',\n    version: NODE_DRIVER_VERSION\n  };\n\n  // This is where we handle additional driver info added after client construction.\n  for (const { name: n = '', version: v = '' } of driverInfoList) {\n    if (n.length > 0) {\n      driverInfo.name = `${driverInfo.name}|${n}`;\n    }\n    if (v.length > 0) {\n      driverInfo.version = `${driverInfo.version}|${v}`;\n    }\n  }\n\n  if (!metadataDocument.ifItFitsItSits('driver', driverInfo)) {\n    throw new MongoInvalidArgumentError(\n      'Unable to include driverInfo name and version, metadata cannot exceed 512 bytes'\n    );\n  }\n\n  let runtimeInfo = getRuntimeInfo();\n  // This is where we handle additional driver info added after client construction.\n  for (const { platform = '' } of driverInfoList) {\n    if (platform.length > 0) {\n      runtimeInfo = `${runtimeInfo}|${platform}`;\n    }\n  }\n\n  if (!metadataDocument.ifItFitsItSits('platform', runtimeInfo)) {\n    throw new MongoInvalidArgumentError(\n      'Unable to include driverInfo platform, metadata cannot exceed 512 bytes'\n    );\n  }\n\n  // Note: order matters, os.type is last so it will be removed last if we're at maxSize\n  const osInfo = new Map()\n    .set('name', process.platform)\n    .set('architecture', process.arch)\n    .set('version', os.release())\n    .set('type', os.type());\n\n  if (!metadataDocument.ifItFitsItSits('os', osInfo)) {\n    for (const key of osInfo.keys()) {\n      osInfo.delete(key);\n      if (osInfo.size === 0) break;\n      if (metadataDocument.ifItFitsItSits('os', osInfo)) break;\n    }\n  }\n\n  const faasEnv = getFAASEnv();\n  if (faasEnv != null) {\n    if (!metadataDocument.ifItFitsItSits('env', faasEnv)) {\n      for (const key of faasEnv.keys()) {\n        faasEnv.delete(key);\n        if (faasEnv.size === 0) break;\n        if (metadataDocument.ifItFitsItSits('env', faasEnv)) break;\n      }\n    }\n  }\n  return await addContainerMetadata(metadataDocument.toObject() as ClientMetadata);\n}\n\nlet dockerPromise: Promise<boolean>;\ntype ContainerMetadata = NonNullable<NonNullable<ClientMetadata['env']>['container']>;\n/** @internal */\nasync function getContainerMetadata(): Promise<ContainerMetadata> {\n  dockerPromise ??= fileIsAccessible('/.dockerenv');\n  const isDocker = await dockerPromise;\n\n  const { KUBERNETES_SERVICE_HOST = '' } = process.env;\n  const isKubernetes = KUBERNETES_SERVICE_HOST.length > 0 ? true : false;\n\n  const containerMetadata: ContainerMetadata = {};\n\n  if (isDocker) containerMetadata.runtime = 'docker';\n  if (isKubernetes) containerMetadata.orchestrator = 'kubernetes';\n\n  return containerMetadata;\n}\n\n/**\n * @internal\n * Re-add each metadata value.\n * Attempt to add new env container metadata, but keep old data if it does not fit.\n */\nasync function addContainerMetadata(originalMetadata: ClientMetadata): Promise<ClientMetadata> {\n  const containerMetadata = await getContainerMetadata();\n  if (Object.keys(containerMetadata).length === 0) return originalMetadata;\n\n  const extendedMetadata = new LimitedSizeDocument(512);\n\n  const extendedEnvMetadata: NonNullable<ClientMetadata['env']> = {\n    ...originalMetadata?.env,\n    container: containerMetadata\n  };\n\n  for (const [key, val] of Object.entries(originalMetadata)) {\n    if (key !== 'env') {\n      extendedMetadata.ifItFitsItSits(key, val);\n    } else {\n      if (!extendedMetadata.ifItFitsItSits('env', extendedEnvMetadata)) {\n        // add in old data if newer / extended metadata does not fit\n        extendedMetadata.ifItFitsItSits('env', val);\n      }\n    }\n  }\n\n  if (!('env' in originalMetadata)) {\n    extendedMetadata.ifItFitsItSits('env', extendedEnvMetadata);\n  }\n\n  return extendedMetadata.toObject() as ClientMetadata;\n}\n\n/**\n * Collects FaaS metadata.\n * - `name` MUST be the last key in the Map returned.\n */\nexport function getFAASEnv(): Map<string, string | Int32> | null {\n  const {\n    AWS_EXECUTION_ENV = '',\n    AWS_LAMBDA_RUNTIME_API = '',\n    FUNCTIONS_WORKER_RUNTIME = '',\n    K_SERVICE = '',\n    FUNCTION_NAME = '',\n    VERCEL = '',\n    AWS_LAMBDA_FUNCTION_MEMORY_SIZE = '',\n    AWS_REGION = '',\n    FUNCTION_MEMORY_MB = '',\n    FUNCTION_REGION = '',\n    FUNCTION_TIMEOUT_SEC = '',\n    VERCEL_REGION = ''\n  } = process.env;\n\n  const isAWSFaaS =\n    AWS_EXECUTION_ENV.startsWith('AWS_Lambda_') || AWS_LAMBDA_RUNTIME_API.length > 0;\n  const isAzureFaaS = FUNCTIONS_WORKER_RUNTIME.length > 0;\n  const isGCPFaaS = K_SERVICE.length > 0 || FUNCTION_NAME.length > 0;\n  const isVercelFaaS = VERCEL.length > 0;\n\n  // Note: order matters, name must always be the last key\n  const faasEnv = new Map();\n\n  // When isVercelFaaS is true so is isAWSFaaS; Vercel inherits the AWS env\n  if (isVercelFaaS && !(isAzureFaaS || isGCPFaaS)) {\n    if (VERCEL_REGION.length > 0) {\n      faasEnv.set('region', VERCEL_REGION);\n    }\n\n    faasEnv.set('name', 'vercel');\n    return faasEnv;\n  }\n\n  if (isAWSFaaS && !(isAzureFaaS || isGCPFaaS || isVercelFaaS)) {\n    if (AWS_REGION.length > 0) {\n      faasEnv.set('region', AWS_REGION);\n    }\n\n    if (\n      AWS_LAMBDA_FUNCTION_MEMORY_SIZE.length > 0 &&\n      Number.isInteger(+AWS_LAMBDA_FUNCTION_MEMORY_SIZE)\n    ) {\n      faasEnv.set('memory_mb', new Int32(AWS_LAMBDA_FUNCTION_MEMORY_SIZE));\n    }\n\n    faasEnv.set('name', 'aws.lambda');\n    return faasEnv;\n  }\n\n  if (isAzureFaaS && !(isGCPFaaS || isAWSFaaS || isVercelFaaS)) {\n    faasEnv.set('name', 'azure.func');\n    return faasEnv;\n  }\n\n  if (isGCPFaaS && !(isAzureFaaS || isAWSFaaS || isVercelFaaS)) {\n    if (FUNCTION_REGION.length > 0) {\n      faasEnv.set('region', FUNCTION_REGION);\n    }\n\n    if (FUNCTION_MEMORY_MB.length > 0 && Number.isInteger(+FUNCTION_MEMORY_MB)) {\n      faasEnv.set('memory_mb', new Int32(FUNCTION_MEMORY_MB));\n    }\n\n    if (FUNCTION_TIMEOUT_SEC.length > 0 && Number.isInteger(+FUNCTION_TIMEOUT_SEC)) {\n      faasEnv.set('timeout_sec', new Int32(FUNCTION_TIMEOUT_SEC));\n    }\n\n    faasEnv.set('name', 'gcp.func');\n    return faasEnv;\n  }\n\n  return null;\n}\n\n/**\n * @internal\n * This type represents the global Deno object and the minimal type contract we expect it to satisfy.\n */\ndeclare const Deno: { version?: { deno?: string } } | undefined;\n\n/**\n * @internal\n * This type represents the global Bun object and the minimal type contract we expect it to satisfy.\n */\ndeclare const Bun: { (): void; version?: string } | undefined;\n\n/**\n * @internal\n * Get current JavaScript runtime platform\n *\n * NOTE: The version information fetching is intentionally written defensively\n * to avoid having a released driver version that becomes incompatible\n * with a future change to these global objects.\n */\nfunction getRuntimeInfo(): string {\n  if ('Deno' in globalThis) {\n    const version = typeof Deno?.version?.deno === 'string' ? Deno?.version?.deno : '0.0.0-unknown';\n\n    return `Deno v${version}, ${os.endianness()}`;\n  }\n\n  if ('Bun' in globalThis) {\n    const version = typeof Bun?.version === 'string' ? Bun?.version : '0.0.0-unknown';\n\n    return `Bun v${version}, ${os.endianness()}`;\n  }\n\n  return `Node.js ${process.version}, ${os.endianness()}`;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}