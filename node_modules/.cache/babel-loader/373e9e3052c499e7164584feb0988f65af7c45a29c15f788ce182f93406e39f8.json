{"ast":null,"code":"'use strict';\n\n/**\n * MongoDB throws an error if there's unused array filters. That is, if `options.arrayFilters` defines\n * a filter, but none of the `update` keys use it. This should be enough to filter out all unused array\n * filters.\n */\nmodule.exports = function removeUnusedArrayFilters(update, arrayFilters) {\n  const updateKeys = Object.keys(update).map(key => Object.keys(update[key])).reduce((cur, arr) => cur.concat(arr), []);\n  return arrayFilters.filter(obj => {\n    return _checkSingleFilterKey(obj, updateKeys);\n  });\n};\nfunction _checkSingleFilterKey(arrayFilter, updateKeys) {\n  const firstKey = Object.keys(arrayFilter)[0];\n  if (firstKey === '$and' || firstKey === '$or') {\n    if (!Array.isArray(arrayFilter[firstKey])) {\n      return false;\n    }\n    return arrayFilter[firstKey].find(filter => _checkSingleFilterKey(filter, updateKeys)) != null;\n  }\n  const firstDot = firstKey.indexOf('.');\n  const arrayFilterKey = firstDot === -1 ? firstKey : firstKey.slice(0, firstDot);\n  return updateKeys.find(key => key.includes('$[' + arrayFilterKey + ']')) != null;\n}","map":{"version":3,"names":["module","exports","removeUnusedArrayFilters","update","arrayFilters","updateKeys","Object","keys","map","key","reduce","cur","arr","concat","filter","obj","_checkSingleFilterKey","arrayFilter","firstKey","Array","isArray","find","firstDot","indexOf","arrayFilterKey","slice","includes"],"sources":["C:/DEVC/node_modules/mongoose/lib/helpers/update/removeUnusedArrayFilters.js"],"sourcesContent":["'use strict';\n\n/**\n * MongoDB throws an error if there's unused array filters. That is, if `options.arrayFilters` defines\n * a filter, but none of the `update` keys use it. This should be enough to filter out all unused array\n * filters.\n */\n\nmodule.exports = function removeUnusedArrayFilters(update, arrayFilters) {\n  const updateKeys = Object.keys(update).\n    map(key => Object.keys(update[key])).\n    reduce((cur, arr) => cur.concat(arr), []);\n  return arrayFilters.filter(obj => {\n    return _checkSingleFilterKey(obj, updateKeys);\n  });\n};\n\nfunction _checkSingleFilterKey(arrayFilter, updateKeys) {\n  const firstKey = Object.keys(arrayFilter)[0];\n\n  if (firstKey === '$and' || firstKey === '$or') {\n    if (!Array.isArray(arrayFilter[firstKey])) {\n      return false;\n    }\n    return arrayFilter[firstKey].find(filter => _checkSingleFilterKey(filter, updateKeys)) != null;\n  }\n\n  const firstDot = firstKey.indexOf('.');\n  const arrayFilterKey = firstDot === -1 ? firstKey : firstKey.slice(0, firstDot);\n\n  return updateKeys.find(key => key.includes('$[' + arrayFilterKey + ']')) != null;\n}\n"],"mappings":"AAAA,YAAY;;AAEZ;AACA;AACA;AACA;AACA;AAEAA,MAAM,CAACC,OAAO,GAAG,SAASC,wBAAwBA,CAACC,MAAM,EAAEC,YAAY,EAAE;EACvE,MAAMC,UAAU,GAAGC,MAAM,CAACC,IAAI,CAACJ,MAAM,CAAC,CACpCK,GAAG,CAACC,GAAG,IAAIH,MAAM,CAACC,IAAI,CAACJ,MAAM,CAACM,GAAG,CAAC,CAAC,CAAC,CACpCC,MAAM,CAAC,CAACC,GAAG,EAAEC,GAAG,KAAKD,GAAG,CAACE,MAAM,CAACD,GAAG,CAAC,EAAE,EAAE,CAAC;EAC3C,OAAOR,YAAY,CAACU,MAAM,CAACC,GAAG,IAAI;IAChC,OAAOC,qBAAqB,CAACD,GAAG,EAAEV,UAAU,CAAC;EAC/C,CAAC,CAAC;AACJ,CAAC;AAED,SAASW,qBAAqBA,CAACC,WAAW,EAAEZ,UAAU,EAAE;EACtD,MAAMa,QAAQ,GAAGZ,MAAM,CAACC,IAAI,CAACU,WAAW,CAAC,CAAC,CAAC,CAAC;EAE5C,IAAIC,QAAQ,KAAK,MAAM,IAAIA,QAAQ,KAAK,KAAK,EAAE;IAC7C,IAAI,CAACC,KAAK,CAACC,OAAO,CAACH,WAAW,CAACC,QAAQ,CAAC,CAAC,EAAE;MACzC,OAAO,KAAK;IACd;IACA,OAAOD,WAAW,CAACC,QAAQ,CAAC,CAACG,IAAI,CAACP,MAAM,IAAIE,qBAAqB,CAACF,MAAM,EAAET,UAAU,CAAC,CAAC,IAAI,IAAI;EAChG;EAEA,MAAMiB,QAAQ,GAAGJ,QAAQ,CAACK,OAAO,CAAC,GAAG,CAAC;EACtC,MAAMC,cAAc,GAAGF,QAAQ,KAAK,CAAC,CAAC,GAAGJ,QAAQ,GAAGA,QAAQ,CAACO,KAAK,CAAC,CAAC,EAAEH,QAAQ,CAAC;EAE/E,OAAOjB,UAAU,CAACgB,IAAI,CAACZ,GAAG,IAAIA,GAAG,CAACiB,QAAQ,CAAC,IAAI,GAAGF,cAAc,GAAG,GAAG,CAAC,CAAC,IAAI,IAAI;AAClF","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}