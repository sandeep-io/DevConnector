{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CountOperation = void 0;\nconst responses_1 = require(\"../cmap/wire_protocol/responses\");\nconst command_1 = require(\"./command\");\nconst operation_1 = require(\"./operation\");\n/** @internal */\nclass CountOperation extends command_1.CommandOperation {\n  constructor(namespace, filter, options) {\n    super({\n      s: {\n        namespace: namespace\n      }\n    }, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.MongoDBResponse;\n    this.options = options;\n    this.collectionName = namespace.collection;\n    this.query = filter;\n  }\n  get commandName() {\n    return 'count';\n  }\n  buildCommandDocument(_connection, _session) {\n    const options = this.options;\n    const cmd = {\n      count: this.collectionName,\n      query: this.query\n    };\n    if (typeof options.limit === 'number') {\n      cmd.limit = options.limit;\n    }\n    if (typeof options.skip === 'number') {\n      cmd.skip = options.skip;\n    }\n    if (options.hint != null) {\n      cmd.hint = options.hint;\n    }\n    if (typeof options.maxTimeMS === 'number') {\n      cmd.maxTimeMS = options.maxTimeMS;\n    }\n    return cmd;\n  }\n  handleOk(response) {\n    return response.getNumber('n') ?? 0;\n  }\n}\nexports.CountOperation = CountOperation;\n(0, operation_1.defineAspects)(CountOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE, operation_1.Aspect.SUPPORTS_RAW_DATA]);","map":{"version":3,"names":["responses_1","require","command_1","operation_1","CountOperation","CommandOperation","constructor","namespace","filter","options","s","SERVER_COMMAND_RESPONSE_TYPE","MongoDBResponse","collectionName","collection","query","commandName","buildCommandDocument","_connection","_session","cmd","count","limit","skip","hint","maxTimeMS","handleOk","response","getNumber","exports","defineAspects","Aspect","READ_OPERATION","RETRYABLE","SUPPORTS_RAW_DATA"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\count.ts"],"sourcesContent":["import { type Connection } from '..';\nimport type { Document } from '../bson';\nimport { MongoDBResponse } from '../cmap/wire_protocol/responses';\nimport type { Collection } from '../collection';\nimport type { ClientSession } from '../sessions';\nimport type { MongoDBNamespace } from '../utils';\nimport { CommandOperation, type CommandOperationOptions } from './command';\nimport { Aspect, defineAspects } from './operation';\n\n/** @public */\nexport interface CountOptions extends CommandOperationOptions {\n  /** The number of documents to skip. */\n  skip?: number;\n  /** The maximum amounts to count before aborting. */\n  limit?: number;\n  /**\n   * Number of milliseconds to wait before aborting the query.\n   */\n  maxTimeMS?: number;\n  /** An index name hint for the query. */\n  hint?: string | Document;\n}\n\n/** @internal */\nexport class CountOperation extends CommandOperation<number> {\n  override SERVER_COMMAND_RESPONSE_TYPE = MongoDBResponse;\n  override options: CountOptions;\n  collectionName?: string;\n  query: Document;\n\n  constructor(namespace: MongoDBNamespace, filter: Document, options: CountOptions) {\n    super({ s: { namespace: namespace } } as unknown as Collection, options);\n\n    this.options = options;\n    this.collectionName = namespace.collection;\n    this.query = filter;\n  }\n\n  override get commandName() {\n    return 'count' as const;\n  }\n\n  override buildCommandDocument(_connection: Connection, _session?: ClientSession): Document {\n    const options = this.options;\n    const cmd: Document = {\n      count: this.collectionName,\n      query: this.query\n    };\n\n    if (typeof options.limit === 'number') {\n      cmd.limit = options.limit;\n    }\n\n    if (typeof options.skip === 'number') {\n      cmd.skip = options.skip;\n    }\n\n    if (options.hint != null) {\n      cmd.hint = options.hint;\n    }\n\n    if (typeof options.maxTimeMS === 'number') {\n      cmd.maxTimeMS = options.maxTimeMS;\n    }\n\n    return cmd;\n  }\n\n  override handleOk(response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>): number {\n    return response.getNumber('n') ?? 0;\n  }\n}\n\ndefineAspects(CountOperation, [Aspect.READ_OPERATION, Aspect.RETRYABLE, Aspect.SUPPORTS_RAW_DATA]);\n"],"mappings":";;;;;;AAEA,MAAAA,WAAA,GAAAC,OAAA;AAIA,MAAAC,SAAA,GAAAD,OAAA;AACA,MAAAE,WAAA,GAAAF,OAAA;AAgBA;AACA,MAAaG,cAAe,SAAQF,SAAA,CAAAG,gBAAwB;EAM1DC,YAAYC,SAA2B,EAAEC,MAAgB,EAAEC,OAAqB;IAC9E,KAAK,CAAC;MAAEC,CAAC,EAAE;QAAEH,SAAS,EAAEA;MAAS;IAAE,CAA2B,EAAEE,OAAO,CAAC;IANjE,KAAAE,4BAA4B,GAAGX,WAAA,CAAAY,eAAe;IAQrD,IAAI,CAACH,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACI,cAAc,GAAGN,SAAS,CAACO,UAAU;IAC1C,IAAI,CAACC,KAAK,GAAGP,MAAM;EACrB;EAEA,IAAaQ,WAAWA,CAAA;IACtB,OAAO,OAAgB;EACzB;EAESC,oBAAoBA,CAACC,WAAuB,EAAEC,QAAwB;IAC7E,MAAMV,OAAO,GAAG,IAAI,CAACA,OAAO;IAC5B,MAAMW,GAAG,GAAa;MACpBC,KAAK,EAAE,IAAI,CAACR,cAAc;MAC1BE,KAAK,EAAE,IAAI,CAACA;KACb;IAED,IAAI,OAAON,OAAO,CAACa,KAAK,KAAK,QAAQ,EAAE;MACrCF,GAAG,CAACE,KAAK,GAAGb,OAAO,CAACa,KAAK;IAC3B;IAEA,IAAI,OAAOb,OAAO,CAACc,IAAI,KAAK,QAAQ,EAAE;MACpCH,GAAG,CAACG,IAAI,GAAGd,OAAO,CAACc,IAAI;IACzB;IAEA,IAAId,OAAO,CAACe,IAAI,IAAI,IAAI,EAAE;MACxBJ,GAAG,CAACI,IAAI,GAAGf,OAAO,CAACe,IAAI;IACzB;IAEA,IAAI,OAAOf,OAAO,CAACgB,SAAS,KAAK,QAAQ,EAAE;MACzCL,GAAG,CAACK,SAAS,GAAGhB,OAAO,CAACgB,SAAS;IACnC;IAEA,OAAOL,GAAG;EACZ;EAESM,QAAQA,CAACC,QAAgE;IAChF,OAAOA,QAAQ,CAACC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC;EACrC;;AA9CFC,OAAA,CAAAzB,cAAA,GAAAA,cAAA;AAiDA,IAAAD,WAAA,CAAA2B,aAAa,EAAC1B,cAAc,EAAE,CAACD,WAAA,CAAA4B,MAAM,CAACC,cAAc,EAAE7B,WAAA,CAAA4B,MAAM,CAACE,SAAS,EAAE9B,WAAA,CAAA4B,MAAM,CAACG,iBAAiB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}