{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InsertOneOperation = exports.InsertOperation = void 0;\nconst responses_1 = require(\"../cmap/wire_protocol/responses\");\nconst error_1 = require(\"../error\");\nconst utils_1 = require(\"../utils\");\nconst command_1 = require(\"./command\");\nconst operation_1 = require(\"./operation\");\n/** @internal */\nclass InsertOperation extends command_1.CommandOperation {\n  constructor(ns, documents, options) {\n    super(undefined, options);\n    this.SERVER_COMMAND_RESPONSE_TYPE = responses_1.MongoDBResponse;\n    this.options = {\n      ...options,\n      checkKeys: options.checkKeys ?? false\n    };\n    this.ns = ns;\n    this.documents = documents;\n  }\n  get commandName() {\n    return 'insert';\n  }\n  buildCommandDocument(_connection, _session) {\n    const options = this.options ?? {};\n    const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n    const command = {\n      insert: this.ns.collection,\n      documents: this.documents,\n      ordered\n    };\n    if (typeof options.bypassDocumentValidation === 'boolean') {\n      command.bypassDocumentValidation = options.bypassDocumentValidation;\n    }\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if (options.comment !== undefined) {\n      command.comment = options.comment;\n    }\n    return command;\n  }\n}\nexports.InsertOperation = InsertOperation;\nclass InsertOneOperation extends InsertOperation {\n  constructor(collection, doc, options) {\n    super(collection.s.namespace, [(0, utils_1.maybeAddIdToDocuments)(collection, doc, options)], options);\n  }\n  handleOk(response) {\n    const res = super.handleOk(response);\n    if (res.code) throw new error_1.MongoServerError(res);\n    if (res.writeErrors) {\n      // This should be a WriteError but we can't change it now because of error hierarchy\n      throw new error_1.MongoServerError(res.writeErrors[0]);\n    }\n    return {\n      acknowledged: this.writeConcern?.w !== 0,\n      insertedId: this.documents[0]._id\n    };\n  }\n}\nexports.InsertOneOperation = InsertOneOperation;\n(0, operation_1.defineAspects)(InsertOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.SUPPORTS_RAW_DATA]);\n(0, operation_1.defineAspects)(InsertOneOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.SUPPORTS_RAW_DATA]);","map":{"version":3,"names":["responses_1","require","error_1","utils_1","command_1","operation_1","InsertOperation","CommandOperation","constructor","ns","documents","options","undefined","SERVER_COMMAND_RESPONSE_TYPE","MongoDBResponse","checkKeys","commandName","buildCommandDocument","_connection","_session","ordered","command","insert","collection","bypassDocumentValidation","comment","exports","InsertOneOperation","doc","s","namespace","maybeAddIdToDocuments","handleOk","response","res","code","MongoServerError","writeErrors","acknowledged","writeConcern","w","insertedId","_id","defineAspects","Aspect","RETRYABLE","WRITE_OPERATION","SUPPORTS_RAW_DATA"],"sources":["C:\\DEVC\\node_modules\\mongodb\\src\\operations\\insert.ts"],"sourcesContent":["import { type Connection } from '..';\nimport type { Document } from '../bson';\nimport type { BulkWriteOptions } from '../bulk/common';\nimport { MongoDBResponse } from '../cmap/wire_protocol/responses';\nimport type { Collection } from '../collection';\nimport { MongoServerError } from '../error';\nimport type { InferIdType } from '../mongo_types';\nimport type { ClientSession } from '../sessions';\nimport { maybeAddIdToDocuments, type MongoDBNamespace } from '../utils';\nimport { CommandOperation, type CommandOperationOptions } from './command';\nimport { Aspect, defineAspects } from './operation';\n/** @internal */\nexport class InsertOperation extends CommandOperation<Document> {\n  override SERVER_COMMAND_RESPONSE_TYPE = MongoDBResponse;\n  override options: BulkWriteOptions;\n\n  documents: Document[];\n\n  constructor(ns: MongoDBNamespace, documents: Document[], options: BulkWriteOptions) {\n    super(undefined, options);\n    this.options = { ...options, checkKeys: options.checkKeys ?? false };\n    this.ns = ns;\n    this.documents = documents;\n  }\n\n  override get commandName() {\n    return 'insert' as const;\n  }\n\n  override buildCommandDocument(_connection: Connection, _session?: ClientSession): Document {\n    const options = this.options ?? {};\n    const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n    const command: Document = {\n      insert: this.ns.collection,\n      documents: this.documents,\n      ordered\n    };\n\n    if (typeof options.bypassDocumentValidation === 'boolean') {\n      command.bypassDocumentValidation = options.bypassDocumentValidation;\n    }\n\n    // we check for undefined specifically here to allow falsy values\n    // eslint-disable-next-line no-restricted-syntax\n    if (options.comment !== undefined) {\n      command.comment = options.comment;\n    }\n\n    return command;\n  }\n}\n\n/** @public */\nexport interface InsertOneOptions extends CommandOperationOptions {\n  /** Allow driver to bypass schema validation. */\n  bypassDocumentValidation?: boolean;\n  /** Force server to assign _id values instead of driver. */\n  forceServerObjectId?: boolean;\n}\n\n/** @public */\nexport interface InsertOneResult<TSchema = Document> {\n  /** Indicates whether this write result was acknowledged. If not, then all other members of this result will be undefined */\n  acknowledged: boolean;\n  /** The identifier that was inserted. If the server generated the identifier, this value will be null as the driver does not have access to that data */\n  insertedId: InferIdType<TSchema>;\n}\n\nexport class InsertOneOperation extends InsertOperation {\n  constructor(collection: Collection, doc: Document, options: InsertOneOptions) {\n    super(collection.s.namespace, [maybeAddIdToDocuments(collection, doc, options)], options);\n  }\n\n  override handleOk(response: InstanceType<typeof this.SERVER_COMMAND_RESPONSE_TYPE>): Document {\n    const res = super.handleOk(response);\n    if (res.code) throw new MongoServerError(res);\n    if (res.writeErrors) {\n      // This should be a WriteError but we can't change it now because of error hierarchy\n      throw new MongoServerError(res.writeErrors[0]);\n    }\n\n    return {\n      acknowledged: this.writeConcern?.w !== 0,\n      insertedId: this.documents[0]._id\n    };\n  }\n}\n\n/** @public */\nexport interface InsertManyResult<TSchema = Document> {\n  /** Indicates whether this write result was acknowledged. If not, then all other members of this result will be undefined */\n  acknowledged: boolean;\n  /** The number of inserted documents for this operations */\n  insertedCount: number;\n  /** Map of the index of the inserted document to the id of the inserted document */\n  insertedIds: { [key: number]: InferIdType<TSchema> };\n}\n\ndefineAspects(InsertOperation, [\n  Aspect.RETRYABLE,\n  Aspect.WRITE_OPERATION,\n  Aspect.SUPPORTS_RAW_DATA\n]);\ndefineAspects(InsertOneOperation, [\n  Aspect.RETRYABLE,\n  Aspect.WRITE_OPERATION,\n  Aspect.SUPPORTS_RAW_DATA\n]);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}