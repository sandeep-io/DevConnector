{"ast":null,"code":"'use strict';\n\nconst hasIncludedChildren = require('./hasIncludedChildren');\nconst isExclusive = require('./isExclusive');\nconst isInclusive = require('./isInclusive');\nconst isPOJO = require('../../utils').isPOJO;\nmodule.exports = function applyProjection(doc, projection, _hasIncludedChildren) {\n  if (projection == null) {\n    return doc;\n  }\n  if (doc == null) {\n    return doc;\n  }\n  let exclude = null;\n  if (isInclusive(projection)) {\n    exclude = false;\n  } else if (isExclusive(projection)) {\n    exclude = true;\n  }\n  if (exclude == null) {\n    return doc;\n  } else if (exclude) {\n    _hasIncludedChildren = _hasIncludedChildren || hasIncludedChildren(projection);\n    return applyExclusiveProjection(doc, projection, _hasIncludedChildren);\n  } else {\n    _hasIncludedChildren = _hasIncludedChildren || hasIncludedChildren(projection);\n    return applyInclusiveProjection(doc, projection, _hasIncludedChildren);\n  }\n};\nfunction applyExclusiveProjection(doc, projection, hasIncludedChildren, projectionLimb, prefix) {\n  if (doc == null || typeof doc !== 'object') {\n    return doc;\n  }\n  if (Array.isArray(doc)) {\n    return doc.map(el => applyExclusiveProjection(el, projection, hasIncludedChildren, projectionLimb, prefix));\n  }\n  const ret = {\n    ...doc\n  };\n  projectionLimb = prefix ? projectionLimb || {} : projection;\n  for (const key of Object.keys(ret)) {\n    const fullPath = prefix ? prefix + '.' + key : key;\n    if (Object.hasOwn(projection, fullPath) || Object.hasOwn(projectionLimb, key)) {\n      if (isPOJO(projection[fullPath]) || isPOJO(projectionLimb[key])) {\n        ret[key] = applyExclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n      } else {\n        delete ret[key];\n      }\n    } else if (hasIncludedChildren[fullPath]) {\n      ret[key] = applyExclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n    }\n  }\n  return ret;\n}\nfunction applyInclusiveProjection(doc, projection, hasIncludedChildren, projectionLimb, prefix) {\n  if (doc == null || typeof doc !== 'object') {\n    return doc;\n  }\n  if (Array.isArray(doc)) {\n    return doc.map(el => applyInclusiveProjection(el, projection, hasIncludedChildren, projectionLimb, prefix));\n  }\n  const ret = {\n    ...doc\n  };\n  projectionLimb = prefix ? projectionLimb || {} : projection;\n  for (const key of Object.keys(ret)) {\n    const fullPath = prefix ? prefix + '.' + key : key;\n    if (Object.hasOwn(projection, fullPath) || Object.hasOwn(projectionLimb, key)) {\n      if (isPOJO(projection[fullPath]) || isPOJO(projectionLimb[key])) {\n        ret[key] = applyInclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n      }\n      continue;\n    } else if (hasIncludedChildren[fullPath]) {\n      ret[key] = applyInclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n    } else {\n      delete ret[key];\n    }\n  }\n  return ret;\n}","map":{"version":3,"names":["hasIncludedChildren","require","isExclusive","isInclusive","isPOJO","module","exports","applyProjection","doc","projection","_hasIncludedChildren","exclude","applyExclusiveProjection","applyInclusiveProjection","projectionLimb","prefix","Array","isArray","map","el","ret","key","Object","keys","fullPath","hasOwn"],"sources":["C:/DEVC/node_modules/mongoose/lib/helpers/projection/applyProjection.js"],"sourcesContent":["'use strict';\n\nconst hasIncludedChildren = require('./hasIncludedChildren');\nconst isExclusive = require('./isExclusive');\nconst isInclusive = require('./isInclusive');\nconst isPOJO = require('../../utils').isPOJO;\n\nmodule.exports = function applyProjection(doc, projection, _hasIncludedChildren) {\n  if (projection == null) {\n    return doc;\n  }\n  if (doc == null) {\n    return doc;\n  }\n\n  let exclude = null;\n  if (isInclusive(projection)) {\n    exclude = false;\n  } else if (isExclusive(projection)) {\n    exclude = true;\n  }\n\n  if (exclude == null) {\n    return doc;\n  } else if (exclude) {\n    _hasIncludedChildren = _hasIncludedChildren || hasIncludedChildren(projection);\n    return applyExclusiveProjection(doc, projection, _hasIncludedChildren);\n  } else {\n    _hasIncludedChildren = _hasIncludedChildren || hasIncludedChildren(projection);\n    return applyInclusiveProjection(doc, projection, _hasIncludedChildren);\n  }\n};\n\nfunction applyExclusiveProjection(doc, projection, hasIncludedChildren, projectionLimb, prefix) {\n  if (doc == null || typeof doc !== 'object') {\n    return doc;\n  }\n  if (Array.isArray(doc)) {\n    return doc.map(el => applyExclusiveProjection(el, projection, hasIncludedChildren, projectionLimb, prefix));\n  }\n  const ret = { ...doc };\n  projectionLimb = prefix ? (projectionLimb || {}) : projection;\n\n  for (const key of Object.keys(ret)) {\n    const fullPath = prefix ? prefix + '.' + key : key;\n    if (Object.hasOwn(projection, fullPath) || Object.hasOwn(projectionLimb, key)) {\n      if (isPOJO(projection[fullPath]) || isPOJO(projectionLimb[key])) {\n        ret[key] = applyExclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n      } else {\n        delete ret[key];\n      }\n    } else if (hasIncludedChildren[fullPath]) {\n      ret[key] = applyExclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n    }\n  }\n  return ret;\n}\n\nfunction applyInclusiveProjection(doc, projection, hasIncludedChildren, projectionLimb, prefix) {\n  if (doc == null || typeof doc !== 'object') {\n    return doc;\n  }\n  if (Array.isArray(doc)) {\n    return doc.map(el => applyInclusiveProjection(el, projection, hasIncludedChildren, projectionLimb, prefix));\n  }\n  const ret = { ...doc };\n  projectionLimb = prefix ? (projectionLimb || {}) : projection;\n\n  for (const key of Object.keys(ret)) {\n    const fullPath = prefix ? prefix + '.' + key : key;\n    if (Object.hasOwn(projection, fullPath) || Object.hasOwn(projectionLimb, key)) {\n      if (isPOJO(projection[fullPath]) || isPOJO(projectionLimb[key])) {\n        ret[key] = applyInclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n      }\n      continue;\n    } else if (hasIncludedChildren[fullPath]) {\n      ret[key] = applyInclusiveProjection(ret[key], projection, hasIncludedChildren, projectionLimb[key], fullPath);\n    } else {\n      delete ret[key];\n    }\n  }\n  return ret;\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,mBAAmB,GAAGC,OAAO,CAAC,uBAAuB,CAAC;AAC5D,MAAMC,WAAW,GAAGD,OAAO,CAAC,eAAe,CAAC;AAC5C,MAAME,WAAW,GAAGF,OAAO,CAAC,eAAe,CAAC;AAC5C,MAAMG,MAAM,GAAGH,OAAO,CAAC,aAAa,CAAC,CAACG,MAAM;AAE5CC,MAAM,CAACC,OAAO,GAAG,SAASC,eAAeA,CAACC,GAAG,EAAEC,UAAU,EAAEC,oBAAoB,EAAE;EAC/E,IAAID,UAAU,IAAI,IAAI,EAAE;IACtB,OAAOD,GAAG;EACZ;EACA,IAAIA,GAAG,IAAI,IAAI,EAAE;IACf,OAAOA,GAAG;EACZ;EAEA,IAAIG,OAAO,GAAG,IAAI;EAClB,IAAIR,WAAW,CAACM,UAAU,CAAC,EAAE;IAC3BE,OAAO,GAAG,KAAK;EACjB,CAAC,MAAM,IAAIT,WAAW,CAACO,UAAU,CAAC,EAAE;IAClCE,OAAO,GAAG,IAAI;EAChB;EAEA,IAAIA,OAAO,IAAI,IAAI,EAAE;IACnB,OAAOH,GAAG;EACZ,CAAC,MAAM,IAAIG,OAAO,EAAE;IAClBD,oBAAoB,GAAGA,oBAAoB,IAAIV,mBAAmB,CAACS,UAAU,CAAC;IAC9E,OAAOG,wBAAwB,CAACJ,GAAG,EAAEC,UAAU,EAAEC,oBAAoB,CAAC;EACxE,CAAC,MAAM;IACLA,oBAAoB,GAAGA,oBAAoB,IAAIV,mBAAmB,CAACS,UAAU,CAAC;IAC9E,OAAOI,wBAAwB,CAACL,GAAG,EAAEC,UAAU,EAAEC,oBAAoB,CAAC;EACxE;AACF,CAAC;AAED,SAASE,wBAAwBA,CAACJ,GAAG,EAAEC,UAAU,EAAET,mBAAmB,EAAEc,cAAc,EAAEC,MAAM,EAAE;EAC9F,IAAIP,GAAG,IAAI,IAAI,IAAI,OAAOA,GAAG,KAAK,QAAQ,EAAE;IAC1C,OAAOA,GAAG;EACZ;EACA,IAAIQ,KAAK,CAACC,OAAO,CAACT,GAAG,CAAC,EAAE;IACtB,OAAOA,GAAG,CAACU,GAAG,CAACC,EAAE,IAAIP,wBAAwB,CAACO,EAAE,EAAEV,UAAU,EAAET,mBAAmB,EAAEc,cAAc,EAAEC,MAAM,CAAC,CAAC;EAC7G;EACA,MAAMK,GAAG,GAAG;IAAE,GAAGZ;EAAI,CAAC;EACtBM,cAAc,GAAGC,MAAM,GAAID,cAAc,IAAI,CAAC,CAAC,GAAIL,UAAU;EAE7D,KAAK,MAAMY,GAAG,IAAIC,MAAM,CAACC,IAAI,CAACH,GAAG,CAAC,EAAE;IAClC,MAAMI,QAAQ,GAAGT,MAAM,GAAGA,MAAM,GAAG,GAAG,GAAGM,GAAG,GAAGA,GAAG;IAClD,IAAIC,MAAM,CAACG,MAAM,CAAChB,UAAU,EAAEe,QAAQ,CAAC,IAAIF,MAAM,CAACG,MAAM,CAACX,cAAc,EAAEO,GAAG,CAAC,EAAE;MAC7E,IAAIjB,MAAM,CAACK,UAAU,CAACe,QAAQ,CAAC,CAAC,IAAIpB,MAAM,CAACU,cAAc,CAACO,GAAG,CAAC,CAAC,EAAE;QAC/DD,GAAG,CAACC,GAAG,CAAC,GAAGT,wBAAwB,CAACQ,GAAG,CAACC,GAAG,CAAC,EAAEZ,UAAU,EAAET,mBAAmB,EAAEc,cAAc,CAACO,GAAG,CAAC,EAAEG,QAAQ,CAAC;MAC/G,CAAC,MAAM;QACL,OAAOJ,GAAG,CAACC,GAAG,CAAC;MACjB;IACF,CAAC,MAAM,IAAIrB,mBAAmB,CAACwB,QAAQ,CAAC,EAAE;MACxCJ,GAAG,CAACC,GAAG,CAAC,GAAGT,wBAAwB,CAACQ,GAAG,CAACC,GAAG,CAAC,EAAEZ,UAAU,EAAET,mBAAmB,EAAEc,cAAc,CAACO,GAAG,CAAC,EAAEG,QAAQ,CAAC;IAC/G;EACF;EACA,OAAOJ,GAAG;AACZ;AAEA,SAASP,wBAAwBA,CAACL,GAAG,EAAEC,UAAU,EAAET,mBAAmB,EAAEc,cAAc,EAAEC,MAAM,EAAE;EAC9F,IAAIP,GAAG,IAAI,IAAI,IAAI,OAAOA,GAAG,KAAK,QAAQ,EAAE;IAC1C,OAAOA,GAAG;EACZ;EACA,IAAIQ,KAAK,CAACC,OAAO,CAACT,GAAG,CAAC,EAAE;IACtB,OAAOA,GAAG,CAACU,GAAG,CAACC,EAAE,IAAIN,wBAAwB,CAACM,EAAE,EAAEV,UAAU,EAAET,mBAAmB,EAAEc,cAAc,EAAEC,MAAM,CAAC,CAAC;EAC7G;EACA,MAAMK,GAAG,GAAG;IAAE,GAAGZ;EAAI,CAAC;EACtBM,cAAc,GAAGC,MAAM,GAAID,cAAc,IAAI,CAAC,CAAC,GAAIL,UAAU;EAE7D,KAAK,MAAMY,GAAG,IAAIC,MAAM,CAACC,IAAI,CAACH,GAAG,CAAC,EAAE;IAClC,MAAMI,QAAQ,GAAGT,MAAM,GAAGA,MAAM,GAAG,GAAG,GAAGM,GAAG,GAAGA,GAAG;IAClD,IAAIC,MAAM,CAACG,MAAM,CAAChB,UAAU,EAAEe,QAAQ,CAAC,IAAIF,MAAM,CAACG,MAAM,CAACX,cAAc,EAAEO,GAAG,CAAC,EAAE;MAC7E,IAAIjB,MAAM,CAACK,UAAU,CAACe,QAAQ,CAAC,CAAC,IAAIpB,MAAM,CAACU,cAAc,CAACO,GAAG,CAAC,CAAC,EAAE;QAC/DD,GAAG,CAACC,GAAG,CAAC,GAAGR,wBAAwB,CAACO,GAAG,CAACC,GAAG,CAAC,EAAEZ,UAAU,EAAET,mBAAmB,EAAEc,cAAc,CAACO,GAAG,CAAC,EAAEG,QAAQ,CAAC;MAC/G;MACA;IACF,CAAC,MAAM,IAAIxB,mBAAmB,CAACwB,QAAQ,CAAC,EAAE;MACxCJ,GAAG,CAACC,GAAG,CAAC,GAAGR,wBAAwB,CAACO,GAAG,CAACC,GAAG,CAAC,EAAEZ,UAAU,EAAET,mBAAmB,EAAEc,cAAc,CAACO,GAAG,CAAC,EAAEG,QAAQ,CAAC;IAC/G,CAAC,MAAM;MACL,OAAOJ,GAAG,CAACC,GAAG,CAAC;IACjB;EACF;EACA,OAAOD,GAAG;AACZ","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}