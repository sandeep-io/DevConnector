{"ast":null,"code":"'use strict';\n\nconst isExclusive = require('../projection/isExclusive');\nconst isInclusive = require('../projection/isInclusive');\n\n/*!\n * ignore\n */\n\nmodule.exports = function selectPopulatedFields(fields, userProvidedFields, populateOptions) {\n  if (populateOptions == null) {\n    return;\n  }\n  const paths = Object.keys(populateOptions);\n  userProvidedFields = userProvidedFields || {};\n  if (isInclusive(fields)) {\n    for (const path of paths) {\n      if (!isPathInFields(userProvidedFields, path)) {\n        fields[path] = 1;\n      } else if (userProvidedFields[path] === 0) {\n        delete fields[path];\n      }\n      const refPath = populateOptions[path]?.refPath;\n      if (typeof refPath === 'string') {\n        if (!isPathInFields(userProvidedFields, refPath)) {\n          fields[refPath] = 1;\n        } else if (userProvidedFields[refPath] === 0) {\n          delete fields[refPath];\n        }\n      }\n    }\n  } else if (isExclusive(fields)) {\n    for (const path of paths) {\n      if (userProvidedFields[path] == null) {\n        delete fields[path];\n      }\n      const refPath = populateOptions[path]?.refPath;\n      if (typeof refPath === 'string' && userProvidedFields[refPath] == null) {\n        delete fields[refPath];\n      }\n    }\n  }\n};\n\n/*!\n * ignore\n */\n\nfunction isPathInFields(userProvidedFields, path) {\n  const pieces = path.split('.');\n  const len = pieces.length;\n  let cur = pieces[0];\n  for (let i = 1; i < len; ++i) {\n    if (userProvidedFields[cur] != null || userProvidedFields[cur + '.$'] != null) {\n      return true;\n    }\n    cur += '.' + pieces[i];\n  }\n  return userProvidedFields[cur] != null || userProvidedFields[cur + '.$'] != null;\n}","map":{"version":3,"names":["isExclusive","require","isInclusive","module","exports","selectPopulatedFields","fields","userProvidedFields","populateOptions","paths","Object","keys","path","isPathInFields","refPath","pieces","split","len","length","cur","i"],"sources":["C:/DEVC/node_modules/mongoose/lib/helpers/query/selectPopulatedFields.js"],"sourcesContent":["'use strict';\n\nconst isExclusive = require('../projection/isExclusive');\nconst isInclusive = require('../projection/isInclusive');\n\n/*!\n * ignore\n */\n\nmodule.exports = function selectPopulatedFields(fields, userProvidedFields, populateOptions) {\n  if (populateOptions == null) {\n    return;\n  }\n\n  const paths = Object.keys(populateOptions);\n  userProvidedFields = userProvidedFields || {};\n  if (isInclusive(fields)) {\n    for (const path of paths) {\n      if (!isPathInFields(userProvidedFields, path)) {\n        fields[path] = 1;\n      } else if (userProvidedFields[path] === 0) {\n        delete fields[path];\n      }\n\n      const refPath = populateOptions[path]?.refPath;\n      if (typeof refPath === 'string') {\n        if (!isPathInFields(userProvidedFields, refPath)) {\n          fields[refPath] = 1;\n        } else if (userProvidedFields[refPath] === 0) {\n          delete fields[refPath];\n        }\n      }\n    }\n  } else if (isExclusive(fields)) {\n    for (const path of paths) {\n      if (userProvidedFields[path] == null) {\n        delete fields[path];\n      }\n      const refPath = populateOptions[path]?.refPath;\n      if (typeof refPath === 'string' && userProvidedFields[refPath] == null) {\n        delete fields[refPath];\n      }\n    }\n  }\n};\n\n/*!\n * ignore\n */\n\nfunction isPathInFields(userProvidedFields, path) {\n  const pieces = path.split('.');\n  const len = pieces.length;\n  let cur = pieces[0];\n  for (let i = 1; i < len; ++i) {\n    if (userProvidedFields[cur] != null || userProvidedFields[cur + '.$'] != null) {\n      return true;\n    }\n    cur += '.' + pieces[i];\n  }\n  return userProvidedFields[cur] != null || userProvidedFields[cur + '.$'] != null;\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,WAAW,GAAGC,OAAO,CAAC,2BAA2B,CAAC;AACxD,MAAMC,WAAW,GAAGD,OAAO,CAAC,2BAA2B,CAAC;;AAExD;AACA;AACA;;AAEAE,MAAM,CAACC,OAAO,GAAG,SAASC,qBAAqBA,CAACC,MAAM,EAAEC,kBAAkB,EAAEC,eAAe,EAAE;EAC3F,IAAIA,eAAe,IAAI,IAAI,EAAE;IAC3B;EACF;EAEA,MAAMC,KAAK,GAAGC,MAAM,CAACC,IAAI,CAACH,eAAe,CAAC;EAC1CD,kBAAkB,GAAGA,kBAAkB,IAAI,CAAC,CAAC;EAC7C,IAAIL,WAAW,CAACI,MAAM,CAAC,EAAE;IACvB,KAAK,MAAMM,IAAI,IAAIH,KAAK,EAAE;MACxB,IAAI,CAACI,cAAc,CAACN,kBAAkB,EAAEK,IAAI,CAAC,EAAE;QAC7CN,MAAM,CAACM,IAAI,CAAC,GAAG,CAAC;MAClB,CAAC,MAAM,IAAIL,kBAAkB,CAACK,IAAI,CAAC,KAAK,CAAC,EAAE;QACzC,OAAON,MAAM,CAACM,IAAI,CAAC;MACrB;MAEA,MAAME,OAAO,GAAGN,eAAe,CAACI,IAAI,CAAC,EAAEE,OAAO;MAC9C,IAAI,OAAOA,OAAO,KAAK,QAAQ,EAAE;QAC/B,IAAI,CAACD,cAAc,CAACN,kBAAkB,EAAEO,OAAO,CAAC,EAAE;UAChDR,MAAM,CAACQ,OAAO,CAAC,GAAG,CAAC;QACrB,CAAC,MAAM,IAAIP,kBAAkB,CAACO,OAAO,CAAC,KAAK,CAAC,EAAE;UAC5C,OAAOR,MAAM,CAACQ,OAAO,CAAC;QACxB;MACF;IACF;EACF,CAAC,MAAM,IAAId,WAAW,CAACM,MAAM,CAAC,EAAE;IAC9B,KAAK,MAAMM,IAAI,IAAIH,KAAK,EAAE;MACxB,IAAIF,kBAAkB,CAACK,IAAI,CAAC,IAAI,IAAI,EAAE;QACpC,OAAON,MAAM,CAACM,IAAI,CAAC;MACrB;MACA,MAAME,OAAO,GAAGN,eAAe,CAACI,IAAI,CAAC,EAAEE,OAAO;MAC9C,IAAI,OAAOA,OAAO,KAAK,QAAQ,IAAIP,kBAAkB,CAACO,OAAO,CAAC,IAAI,IAAI,EAAE;QACtE,OAAOR,MAAM,CAACQ,OAAO,CAAC;MACxB;IACF;EACF;AACF,CAAC;;AAED;AACA;AACA;;AAEA,SAASD,cAAcA,CAACN,kBAAkB,EAAEK,IAAI,EAAE;EAChD,MAAMG,MAAM,GAAGH,IAAI,CAACI,KAAK,CAAC,GAAG,CAAC;EAC9B,MAAMC,GAAG,GAAGF,MAAM,CAACG,MAAM;EACzB,IAAIC,GAAG,GAAGJ,MAAM,CAAC,CAAC,CAAC;EACnB,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,GAAG,EAAE,EAAEG,CAAC,EAAE;IAC5B,IAAIb,kBAAkB,CAACY,GAAG,CAAC,IAAI,IAAI,IAAIZ,kBAAkB,CAACY,GAAG,GAAG,IAAI,CAAC,IAAI,IAAI,EAAE;MAC7E,OAAO,IAAI;IACb;IACAA,GAAG,IAAI,GAAG,GAAGJ,MAAM,CAACK,CAAC,CAAC;EACxB;EACA,OAAOb,kBAAkB,CAACY,GAAG,CAAC,IAAI,IAAI,IAAIZ,kBAAkB,CAACY,GAAG,GAAG,IAAI,CAAC,IAAI,IAAI;AAClF","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}