{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function () {\n  var ownKeys = function (o) {\n    ownKeys = Object.getOwnPropertyNames || function (o) {\n      var ar = [];\n      for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n      return ar;\n    };\n    return ownKeys(o);\n  };\n  return function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n    __setModuleDefault(result, mod);\n    return result;\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.redactValidConnectionString = redactValidConnectionString;\nexports.redactConnectionString = redactConnectionString;\nconst index_1 = __importStar(require(\"./index\"));\nfunction redactValidConnectionString(inputUrl, options) {\n  const url = inputUrl.clone();\n  const replacementString = options?.replacementString ?? '_credentials_';\n  const redactUsernames = options?.redactUsernames ?? true;\n  if ((url.username || url.password) && redactUsernames) {\n    url.username = replacementString;\n    url.password = '';\n  } else if (url.password) {\n    url.password = replacementString;\n  }\n  if (url.searchParams.has('authMechanismProperties')) {\n    const props = new index_1.CommaAndColonSeparatedRecord(url.searchParams.get('authMechanismProperties'));\n    if (props.get('AWS_SESSION_TOKEN')) {\n      props.set('AWS_SESSION_TOKEN', replacementString);\n      url.searchParams.set('authMechanismProperties', props.toString());\n    }\n  }\n  if (url.searchParams.has('tlsCertificateKeyFilePassword')) {\n    url.searchParams.set('tlsCertificateKeyFilePassword', replacementString);\n  }\n  if (url.searchParams.has('proxyUsername') && redactUsernames) {\n    url.searchParams.set('proxyUsername', replacementString);\n  }\n  if (url.searchParams.has('proxyPassword')) {\n    url.searchParams.set('proxyPassword', replacementString);\n  }\n  return url;\n}\nfunction redactConnectionString(uri, options) {\n  const replacementString = options?.replacementString ?? '<credentials>';\n  const redactUsernames = options?.redactUsernames ?? true;\n  let parsed;\n  try {\n    parsed = new index_1.default(uri);\n  } catch {}\n  if (parsed) {\n    options = {\n      ...options,\n      replacementString: '___credentials___'\n    };\n    return parsed.redact(options).toString().replace(/___credentials___/g, replacementString);\n  }\n  const R = replacementString;\n  const replacements = [uri => uri.replace(redactUsernames ? /(\\/\\/)(.*)(@)/g : /(\\/\\/[^@]*:)(.*)(@)/g, `$1${R}$3`), uri => uri.replace(/(AWS_SESSION_TOKEN(:|%3A))([^,&]+)/gi, `$1${R}`), uri => uri.replace(/(tlsCertificateKeyFilePassword=)([^&]+)/gi, `$1${R}`), uri => redactUsernames ? uri.replace(/(proxyUsername=)([^&]+)/gi, `$1${R}`) : uri, uri => uri.replace(/(proxyPassword=)([^&]+)/gi, `$1${R}`)];\n  for (const replacer of replacements) {\n    uri = replacer(uri);\n  }\n  return uri;\n}","map":{"version":3,"names":["exports","redactValidConnectionString","redactConnectionString","index_1","__importStar","require","inputUrl","options","url","clone","replacementString","redactUsernames","username","password","searchParams","has","props","CommaAndColonSeparatedRecord","get","set","toString","uri","parsed","default","redact","replace","R","replacements","replacer"],"sources":["../src/redact.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}